import{a as l}from"./chunk-FF4B56LT.js";import{A as m,B as h,C as v,D as b,Da as _,Fa as R,J as g,Ja as x,K as y,L as C,Qa as z,Y as S,_a as N,g as s,h as n,i as c,l as d,la as E,na as P,o as p,u,w as i,x as f}from"./chunk-63LJVA47.js";var O=new l,A=(()=>{class o{constructor(r){this.http=r,this.apiUrl=O.URL+"/cardallapis/parametro"}saveParametro(r){return console.log(r),this.http.post(this.apiUrl,r)}editParametro(r){return console.log("editParametro"),console.log(r),this.http.put(this.apiUrl+"/"+r.zx2_cod,r)}static{this.\u0275fac=function(e){return new(e||o)(p(S))}}static{this.\u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var V=["dynamicForm"],M=new l,H=(()=>{class o{constructor(r,e,t,a,I){this.router=r,this.cadastraParametrosService=e,this.poDialog=t,this.poNotification=a,this.route=I,this.parametro=null,this.isEdit=!1,this.MENSAGENS={SUCESSO_CRIAR:"Par\xE2metro criado com sucesso",SUCESSO_EDITAR:"Par\xE2metro atualizado com sucesso",ERRO_CRIAR:"Erro ao salvar registro",ERRO_EDITAR:"Erro ao editar registro",CONFIRMAR_SALVAR:"Deseja realmente salvar o registro?",CARREGANDO:"Processando..."},this.destroy$=new n,this.actions=[{label:"Salvar",action:this.confirmSave.bind(this),disabled:()=>this.dynamicForm?.form.invalid},{label:"Voltar",action:()=>this.navegarParaParametros()}],this.breadcrumb={items:[{label:"Or\xE7amentos",action:()=>this.router.navigate(["/"])},{label:"Par\xE2metros",action:()=>this.navegarParaParametros()},{label:"Cadastro"}]},this.fields=[{property:"zx2_cod",divider:"Par\xE2metro",label:"C\xF3digo",key:!0,required:!0,disabled:!0,gridColumns:4,gridSmColumns:4},{property:"zx2_desc",label:"Descri\xE7\xE3o",placeholder:"Nome do par\xE2metro",required:!0,maxLength:70,gridColumns:4,gridSmColumns:4},{property:"zx2_mod",divider:"M\xE3o de Obra e Produtividade",label:"M\xE3o de Obra",key:!0,optionsService:`${M.URL}/cardallapis/modobra`,optionsMulti:!1,fieldLabel:"b1_desc",fieldValue:"b1_cod",gridColumns:4,gridSmColumns:4},{property:"zx2_tpprod",label:"Tipo Produtividade",required:!0,options:[{value:"K",label:"KG/H",color:"color-01"},{value:"H",label:"Horas",color:"color-02"}],type:"label",gridColumns:4,gridSmColumns:4},{property:"zx2_vlprod",label:"Valor Produtividade",required:!0,type:"number",gridColumns:4,gridSmColumns:4},{property:"zx2_kit",divider:"Kit Tinta",label:"Kit Tinta",key:!0,optionsService:`${M.URL}/cardallapis/kittinta`,optionsMulti:!1,fieldLabel:"b1_desc",fieldValue:"b1_cod",gridColumns:4,gridSmColumns:4},{property:"zx2_var",label:"Vari\xE1vel",type:"label",options:[{value:"P",label:"Peso",color:"color-01"},{value:"E",label:"Externa",color:"color-02"},{value:"I",label:"Interna",color:"color-03"},{value:"",label:"N\xE3o possui",color:"color-05"}]},{property:"zx2_cmc",divider:"Consum\xEDveis",label:"% Consum\xEDveis MC",type:"number",maxValue:100,gridColumns:4,gridSmColumns:4},{property:"zx2_smc",label:"% Sucata MC",type:"number",maxValue:100,gridColumns:4,gridSmColumns:4},{property:"zx2_fmc",label:"% Frete MC",type:"number",maxValue:100,gridColumns:4,gridSmColumns:4},{property:"zx2_cmt",label:"% Consum\xEDveis MT",type:"number",maxValue:100,gridColumns:4,gridSmColumns:4},{property:"zx2_smt",label:"% Sucata MT",type:"number",maxValue:100,gridColumns:4,gridSmColumns:4},{property:"zx2_fmt",label:"% Frete MT",type:"number",maxValue:100,gridColumns:4,gridSmColumns:4}]}ngOnInit(){this.carregarParametro()}carregarParametro(){this.route.queryParams.pipe(c(this.destroy$)).subscribe(r=>{if(r&&r.parametro)try{console.log("parametro",r.parametro);let e=JSON.parse(r.parametro);this.parametro=e,this.isEdit=!0}catch(e){this.tratarErro(e,!1)}else this.parametro={zx2_cod:"",zx2_desc:"",zx2_mod:"",zx2_kit:"",zx2_vlprod:0,zx2_var:"",zx2_cmc:0,zx2_cmt:0,zx2_smc:0,zx2_smt:0,zx2_fmc:0,zx2_fmt:0,zx2_tpprod:""}})}navegarParaParametros(){this.router.navigate(["orcamentos/parametros"])}confirmSave(){this.poDialog.confirm({title:"Confirma\xE7\xE3o",message:this.MENSAGENS.CONFIRMAR_SALVAR,confirm:()=>this.saveRecord(),cancel:()=>{}})}saveRecord(){return s(this,null,function*(){try{this.isEdit?yield this.editarParametro():yield this.criarNovoParametro(),this.navegarParaParametros()}catch(r){this.tratarErro(r,this.isEdit)}})}editarParametro(){return s(this,null,function*(){if(!this.parametro)throw new Error("Par\xE2metro n\xE3o encontrado");yield this.cadastraParametrosService.editParametro(this.parametro).toPromise(),this.poNotification.success(this.MENSAGENS.SUCESSO_EDITAR)})}criarNovoParametro(){return s(this,null,function*(){let r=this.dynamicForm?.form.value;if(!r)throw new Error("Dados do formul\xE1rio inv\xE1lidos");yield this.cadastraParametrosService.saveParametro(r).toPromise(),this.poNotification.success(this.MENSAGENS.SUCESSO_CRIAR)})}tratarErro(r,e){let t=e?this.MENSAGENS.ERRO_EDITAR:this.MENSAGENS.ERRO_CRIAR,a="Erro desconhecido";r instanceof Error?a=r.message:this.isHttpError(r)?(console.log(r.error.errorMessage),a=decodeURIComponent(escape(r.error.errorMessage??""))||"Erro na requisi\xE7\xE3o"):typeof r=="string"&&(a=r),this.poNotification.error(`${t}: ${a}`),console.error("Erro detalhado:",{tipo:r?.constructor?.name||typeof r,mensagem:a,erro:r})}isHttpError(r){return typeof r=="object"&&r!==null&&"error"in r&&typeof r.error=="object"}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(e){return new(e||o)(i(P),i(A),i(_),i(R),i(E))}}static{this.\u0275cmp=f({type:o,selectors:[["app-cadastra-parametros"]],viewQuery:function(e,t){if(e&1&&g(V,7),e&2){let a;y(a=C())&&(t.dynamicForm=a.first)}},decls:3,vars:5,consts:[["dynamicForm",""],[3,"p-title","p-breadcrumb","p-actions"],[3,"p-fields","p-value"]],template:function(e,t){e&1&&(h(0,"po-page-default",1),b(1,"po-dynamic-form",2,0),v()),e&2&&(m("p-title",t.isEdit?"Editar Par\xE2metro":"Novo Par\xE2metro")("p-breadcrumb",t.breadcrumb)("p-actions",t.actions),u(),m("p-fields",t.fields)("p-value",t.parametro))},dependencies:[N,x,z],encapsulation:2})}}return o})();export{H as CadastraParametrosComponent};
