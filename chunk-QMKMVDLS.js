import{a as bt}from"./chunk-FF4B56LT.js";import{Y as wt,c as De,e as Qe,f as Xe,g as le,l as qe,m as yt,n as gt,o as $e,y as mt}from"./chunk-LGW2HRLS.js";var St=Qe((It,Ze)=>{"use strict";(function(D){if(typeof It=="object"&&typeof Ze<"u")Ze.exports=D();else if(typeof define=="function"&&define.amd)define([],D);else{var m;typeof window<"u"?m=window:typeof global<"u"?m=global:typeof self<"u"?m=self:m=this,m.localforage=D()}})(function(){var D,m,c;return function v(y,w,E){function $(q,G){if(!w[q]){if(!y[q]){var P=typeof De=="function"&&De;if(!G&&P)return P(q,!0);if(T)return T(q,!0);var L=new Error("Cannot find module '"+q+"'");throw L.code="MODULE_NOT_FOUND",L}var W=w[q]={exports:{}};y[q][0].call(W.exports,function(re){var he=y[q][1][re];return $(he||re)},W,W.exports,v,y,w,E)}return w[q].exports}for(var T=typeof De=="function"&&De,Q=0;Q<E.length;Q++)$(E[Q]);return $}({1:[function(v,y,w){(function(E){"use strict";var $=E.MutationObserver||E.WebKitMutationObserver,T;if($){var Q=0,q=new $(re),G=E.document.createTextNode("");q.observe(G,{characterData:!0}),T=function(){G.data=Q=++Q%2}}else if(!E.setImmediate&&typeof E.MessageChannel<"u"){var P=new E.MessageChannel;P.port1.onmessage=re,T=function(){P.port2.postMessage(0)}}else"document"in E&&"onreadystatechange"in E.document.createElement("script")?T=function(){var K=E.document.createElement("script");K.onreadystatechange=function(){re(),K.onreadystatechange=null,K.parentNode.removeChild(K),K=null},E.document.documentElement.appendChild(K)}:T=function(){setTimeout(re,0)};var L,W=[];function re(){L=!0;for(var K,me,ie=W.length;ie;){for(me=W,W=[],K=-1;++K<ie;)me[K]();ie=W.length}L=!1}y.exports=he;function he(K){W.push(K)===1&&!L&&T()}}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(v,y,w){"use strict";var E=v(1);function $(){}var T={},Q=["REJECTED"],q=["FULFILLED"],G=["PENDING"];y.exports=P;function P(k){if(typeof k!="function")throw new TypeError("resolver must be a function");this.state=G,this.queue=[],this.outcome=void 0,k!==$&&he(this,k)}P.prototype.catch=function(k){return this.then(null,k)},P.prototype.then=function(k,H){if(typeof k!="function"&&this.state===q||typeof H!="function"&&this.state===Q)return this;var j=new this.constructor($);if(this.state!==G){var X=this.state===q?k:H;W(j,X,this.outcome)}else this.queue.push(new L(j,k,H));return j};function L(k,H,j){this.promise=k,typeof H=="function"&&(this.onFulfilled=H,this.callFulfilled=this.otherCallFulfilled),typeof j=="function"&&(this.onRejected=j,this.callRejected=this.otherCallRejected)}L.prototype.callFulfilled=function(k){T.resolve(this.promise,k)},L.prototype.otherCallFulfilled=function(k){W(this.promise,this.onFulfilled,k)},L.prototype.callRejected=function(k){T.reject(this.promise,k)},L.prototype.otherCallRejected=function(k){W(this.promise,this.onRejected,k)};function W(k,H,j){E(function(){var X;try{X=H(j)}catch(B){return T.reject(k,B)}X===k?T.reject(k,new TypeError("Cannot resolve promise with itself")):T.resolve(k,X)})}T.resolve=function(k,H){var j=K(re,H);if(j.status==="error")return T.reject(k,j.value);var X=j.value;if(X)he(k,X);else{k.state=q,k.outcome=H;for(var B=-1,ce=k.queue.length;++B<ce;)k.queue[B].callFulfilled(H)}return k},T.reject=function(k,H){k.state=Q,k.outcome=H;for(var j=-1,X=k.queue.length;++j<X;)k.queue[j].callRejected(H);return k};function re(k){var H=k&&k.then;if(k&&(typeof k=="object"||typeof k=="function")&&typeof H=="function")return function(){H.apply(k,arguments)}}function he(k,H){var j=!1;function X(I){j||(j=!0,T.reject(k,I))}function B(I){j||(j=!0,T.resolve(k,I))}function ce(){H(B,X)}var V=K(ce);V.status==="error"&&X(V.value)}function K(k,H){var j={};try{j.value=k(H),j.status="success"}catch(X){j.status="error",j.value=X}return j}P.resolve=me;function me(k){return k instanceof this?k:T.resolve(new this($),k)}P.reject=ie;function ie(k){var H=new this($);return T.reject(H,k)}P.all=pe;function pe(k){var H=this;if(Object.prototype.toString.call(k)!=="[object Array]")return this.reject(new TypeError("must be an array"));var j=k.length,X=!1;if(!j)return this.resolve([]);for(var B=new Array(j),ce=0,V=-1,I=new this($);++V<j;)ve(k[V],V);return I;function ve(xe,ke){H.resolve(xe).then(Re,function(Ie){X||(X=!0,T.reject(I,Ie))});function Re(Ie){B[ke]=Ie,++ce===j&&!X&&(X=!0,T.resolve(I,B))}}}P.race=F;function F(k){var H=this;if(Object.prototype.toString.call(k)!=="[object Array]")return this.reject(new TypeError("must be an array"));var j=k.length,X=!1;if(!j)return this.resolve([]);for(var B=-1,ce=new this($);++B<j;)V(k[B]);return ce;function V(I){H.resolve(I).then(function(ve){X||(X=!0,T.resolve(ce,ve))},function(ve){X||(X=!0,T.reject(ce,ve))})}}},{1:1}],3:[function(v,y,w){(function(E){"use strict";typeof E.Promise!="function"&&(E.Promise=v(2))}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(v,y,w){"use strict";var E=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s};function $(s,l){if(!(s instanceof l))throw new TypeError("Cannot call a class as a function")}function T(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var Q=T();function q(){try{if(!Q||!Q.open)return!1;var s=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),l=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!s||l)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function G(s,l){s=s||[],l=l||{};try{return new Blob(s,l)}catch(f){if(f.name!=="TypeError")throw f;for(var o=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,h=new o,d=0;d<s.length;d+=1)h.append(s[d]);return h.getBlob(l.type)}}typeof Promise>"u"&&v(3);var P=Promise;function L(s,l){l&&s.then(function(o){l(null,o)},function(o){l(o)})}function W(s,l,o){typeof l=="function"&&s.then(l),typeof o=="function"&&s.catch(o)}function re(s){return typeof s!="string"&&(console.warn(s+" used as a key, but it is not a string."),s=String(s)),s}function he(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var K="local-forage-detect-blob-support",me=void 0,ie={},pe=Object.prototype.toString,F="readonly",k="readwrite";function H(s){for(var l=s.length,o=new ArrayBuffer(l),h=new Uint8Array(o),d=0;d<l;d++)h[d]=s.charCodeAt(d);return o}function j(s){return new P(function(l){var o=s.transaction(K,k),h=G([""]);o.objectStore(K).put(h,"key"),o.onabort=function(d){d.preventDefault(),d.stopPropagation(),l(!1)},o.oncomplete=function(){var d=navigator.userAgent.match(/Chrome\/(\d+)/),f=navigator.userAgent.match(/Edge\//);l(f||!d||parseInt(d[1],10)>=43)}}).catch(function(){return!1})}function X(s){return typeof me=="boolean"?P.resolve(me):j(s).then(function(l){return me=l,me})}function B(s){var l=ie[s.name],o={};o.promise=new P(function(h,d){o.resolve=h,o.reject=d}),l.deferredOperations.push(o),l.dbReady?l.dbReady=l.dbReady.then(function(){return o.promise}):l.dbReady=o.promise}function ce(s){var l=ie[s.name],o=l.deferredOperations.pop();if(o)return o.resolve(),o.promise}function V(s,l){var o=ie[s.name],h=o.deferredOperations.pop();if(h)return h.reject(l),h.promise}function I(s,l){return new P(function(o,h){if(ie[s.name]=ie[s.name]||we(),s.db)if(l)B(s),s.db.close();else return o(s.db);var d=[s.name];l&&d.push(s.version);var f=Q.open.apply(Q,d);l&&(f.onupgradeneeded=function(b){var S=f.result;try{S.createObjectStore(s.storeName),b.oldVersion<=1&&S.createObjectStore(K)}catch(x){if(x.name==="ConstraintError")console.warn('The database "'+s.name+'" has been upgraded from version '+b.oldVersion+" to version "+b.newVersion+', but the storage "'+s.storeName+'" already exists.');else throw x}}),f.onerror=function(b){b.preventDefault(),h(f.error)},f.onsuccess=function(){var b=f.result;b.onversionchange=function(S){S.target.close()},o(b),ce(s)}})}function ve(s){return I(s,!1)}function xe(s){return I(s,!0)}function ke(s,l){if(!s.db)return!0;var o=!s.db.objectStoreNames.contains(s.storeName),h=s.version<s.db.version,d=s.version>s.db.version;if(h&&(s.version!==l&&console.warn('The database "'+s.name+`" can't be downgraded from version `+s.db.version+" to version "+s.version+"."),s.version=s.db.version),d||o){if(o){var f=s.db.version+1;f>s.version&&(s.version=f)}return!0}return!1}function Re(s){return new P(function(l,o){var h=new FileReader;h.onerror=o,h.onloadend=function(d){var f=btoa(d.target.result||"");l({__local_forage_encoded_blob:!0,data:f,type:s.type})},h.readAsBinaryString(s)})}function Ie(s){var l=H(atob(s.data));return G([l],{type:s.type})}function Ve(s){return s&&s.__local_forage_encoded_blob}function Ne(s){var l=this,o=l._initReady().then(function(){var h=ie[l._dbInfo.name];if(h&&h.dbReady)return h.dbReady});return W(o,s,s),o}function je(s){B(s);for(var l=ie[s.name],o=l.forages,h=0;h<o.length;h++){var d=o[h];d._dbInfo.db&&(d._dbInfo.db.close(),d._dbInfo.db=null)}return s.db=null,ve(s).then(function(f){return s.db=f,ke(s)?xe(s):f}).then(function(f){s.db=l.db=f;for(var b=0;b<o.length;b++)o[b]._dbInfo.db=f}).catch(function(f){throw V(s,f),f})}function ue(s,l,o,h){h===void 0&&(h=1);try{var d=s.db.transaction(s.storeName,l);o(null,d)}catch(f){if(h>0&&(!s.db||f.name==="InvalidStateError"||f.name==="NotFoundError"))return P.resolve().then(function(){if(!s.db||f.name==="NotFoundError"&&!s.db.objectStoreNames.contains(s.storeName)&&s.version<=s.db.version)return s.db&&(s.version=s.db.version+1),xe(s)}).then(function(){return je(s).then(function(){ue(s,l,o,h-1)})}).catch(o);o(f)}}function we(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function _e(s){var l=this,o={db:null};if(s)for(var h in s)o[h]=s[h];var d=ie[o.name];d||(d=we(),ie[o.name]=d),d.forages.push(l),l._initReady||(l._initReady=l.ready,l.ready=Ne);var f=[];function b(){return P.resolve()}for(var S=0;S<d.forages.length;S++){var x=d.forages[S];x!==l&&f.push(x._initReady().catch(b))}var A=d.forages.slice(0);return P.all(f).then(function(){return o.db=d.db,ve(o)}).then(function(_){return o.db=_,ke(o,l._defaultConfig.version)?xe(o):_}).then(function(_){o.db=d.db=_,l._dbInfo=o;for(var M=0;M<A.length;M++){var Y=A[M];Y!==l&&(Y._dbInfo.db=o.db,Y._dbInfo.version=o.version)}})}function Le(s,l){var o=this;s=re(s);var h=new P(function(d,f){o.ready().then(function(){ue(o._dbInfo,F,function(b,S){if(b)return f(b);try{var x=S.objectStore(o._dbInfo.storeName),A=x.get(s);A.onsuccess=function(){var _=A.result;_===void 0&&(_=null),Ve(_)&&(_=Ie(_)),d(_)},A.onerror=function(){f(A.error)}}catch(_){f(_)}})}).catch(f)});return L(h,l),h}function be(s,l){var o=this,h=new P(function(d,f){o.ready().then(function(){ue(o._dbInfo,F,function(b,S){if(b)return f(b);try{var x=S.objectStore(o._dbInfo.storeName),A=x.openCursor(),_=1;A.onsuccess=function(){var M=A.result;if(M){var Y=M.value;Ve(Y)&&(Y=Ie(Y));var Z=s(Y,M.key,_++);Z!==void 0?d(Z):M.continue()}else d()},A.onerror=function(){f(A.error)}}catch(M){f(M)}})}).catch(f)});return L(h,l),h}function Te(s,l,o){var h=this;s=re(s);var d=new P(function(f,b){var S;h.ready().then(function(){return S=h._dbInfo,pe.call(l)==="[object Blob]"?X(S.db).then(function(x){return x?l:Re(l)}):l}).then(function(x){ue(h._dbInfo,k,function(A,_){if(A)return b(A);try{var M=_.objectStore(h._dbInfo.storeName);x===null&&(x=void 0);var Y=M.put(x,s);_.oncomplete=function(){x===void 0&&(x=null),f(x)},_.onabort=_.onerror=function(){var Z=Y.error?Y.error:Y.transaction.error;b(Z)}}catch(Z){b(Z)}})}).catch(b)});return L(d,o),d}function Ue(s,l){var o=this;s=re(s);var h=new P(function(d,f){o.ready().then(function(){ue(o._dbInfo,k,function(b,S){if(b)return f(b);try{var x=S.objectStore(o._dbInfo.storeName),A=x.delete(s);S.oncomplete=function(){d()},S.onerror=function(){f(A.error)},S.onabort=function(){var _=A.error?A.error:A.transaction.error;f(_)}}catch(_){f(_)}})}).catch(f)});return L(h,l),h}function e(s){var l=this,o=new P(function(h,d){l.ready().then(function(){ue(l._dbInfo,k,function(f,b){if(f)return d(f);try{var S=b.objectStore(l._dbInfo.storeName),x=S.clear();b.oncomplete=function(){h()},b.onabort=b.onerror=function(){var A=x.error?x.error:x.transaction.error;d(A)}}catch(A){d(A)}})}).catch(d)});return L(o,s),o}function t(s){var l=this,o=new P(function(h,d){l.ready().then(function(){ue(l._dbInfo,F,function(f,b){if(f)return d(f);try{var S=b.objectStore(l._dbInfo.storeName),x=S.count();x.onsuccess=function(){h(x.result)},x.onerror=function(){d(x.error)}}catch(A){d(A)}})}).catch(d)});return L(o,s),o}function r(s,l){var o=this,h=new P(function(d,f){if(s<0){d(null);return}o.ready().then(function(){ue(o._dbInfo,F,function(b,S){if(b)return f(b);try{var x=S.objectStore(o._dbInfo.storeName),A=!1,_=x.openKeyCursor();_.onsuccess=function(){var M=_.result;if(!M){d(null);return}s===0||A?d(M.key):(A=!0,M.advance(s))},_.onerror=function(){f(_.error)}}catch(M){f(M)}})}).catch(f)});return L(h,l),h}function i(s){var l=this,o=new P(function(h,d){l.ready().then(function(){ue(l._dbInfo,F,function(f,b){if(f)return d(f);try{var S=b.objectStore(l._dbInfo.storeName),x=S.openKeyCursor(),A=[];x.onsuccess=function(){var _=x.result;if(!_){h(A);return}A.push(_.key),_.continue()},x.onerror=function(){d(x.error)}}catch(_){d(_)}})}).catch(d)});return L(o,s),o}function n(s,l){l=he.apply(this,arguments);var o=this.config();s=typeof s!="function"&&s||{},s.name||(s.name=s.name||o.name,s.storeName=s.storeName||o.storeName);var h=this,d;if(!s.name)d=P.reject("Invalid arguments");else{var f=s.name===o.name&&h._dbInfo.db,b=f?P.resolve(h._dbInfo.db):ve(s).then(function(S){var x=ie[s.name],A=x.forages;x.db=S;for(var _=0;_<A.length;_++)A[_]._dbInfo.db=S;return S});s.storeName?d=b.then(function(S){if(S.objectStoreNames.contains(s.storeName)){var x=S.version+1;B(s);var A=ie[s.name],_=A.forages;S.close();for(var M=0;M<_.length;M++){var Y=_[M];Y._dbInfo.db=null,Y._dbInfo.version=x}var Z=new P(function(ee,ae){var se=Q.open(s.name,x);se.onerror=function(ge){var ze=se.result;ze.close(),ae(ge)},se.onupgradeneeded=function(){var ge=se.result;ge.deleteObjectStore(s.storeName)},se.onsuccess=function(){var ge=se.result;ge.close(),ee(ge)}});return Z.then(function(ee){A.db=ee;for(var ae=0;ae<_.length;ae++){var se=_[ae];se._dbInfo.db=ee,ce(se._dbInfo)}}).catch(function(ee){throw(V(s,ee)||P.resolve()).catch(function(){}),ee})}}):d=b.then(function(S){B(s);var x=ie[s.name],A=x.forages;S.close();for(var _=0;_<A.length;_++){var M=A[_];M._dbInfo.db=null}var Y=new P(function(Z,ee){var ae=Q.deleteDatabase(s.name);ae.onerror=function(){var se=ae.result;se&&se.close(),ee(ae.error)},ae.onblocked=function(){console.warn('dropInstance blocked for database "'+s.name+'" until all open connections are closed')},ae.onsuccess=function(){var se=ae.result;se&&se.close(),Z(se)}});return Y.then(function(Z){x.db=Z;for(var ee=0;ee<A.length;ee++){var ae=A[ee];ce(ae._dbInfo)}}).catch(function(Z){throw(V(s,Z)||P.resolve()).catch(function(){}),Z})})}return L(d,l),d}var a={_driver:"asyncStorage",_initStorage:_e,_support:q(),iterate:be,getItem:Le,setItem:Te,removeItem:Ue,clear:e,length:t,key:r,keys:i,dropInstance:n};function u(){return typeof openDatabase=="function"}var p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",g="~~local_forage_type~",C=/^~~local_forage_type~([^~]+)~/,O="__lfsc__:",R=O.length,N="arbf",z="blob",U="si08",te="ui08",oe="uic8",ne="si16",J="si32",fe="ur16",ye="ui32",Se="fl32",de="fl64",Ae=R+N.length,lt=Object.prototype.toString;function ut(s){var l=s.length*.75,o=s.length,h,d=0,f,b,S,x;s[s.length-1]==="="&&(l--,s[s.length-2]==="="&&l--);var A=new ArrayBuffer(l),_=new Uint8Array(A);for(h=0;h<o;h+=4)f=p.indexOf(s[h]),b=p.indexOf(s[h+1]),S=p.indexOf(s[h+2]),x=p.indexOf(s[h+3]),_[d++]=f<<2|b>>4,_[d++]=(b&15)<<4|S>>2,_[d++]=(S&3)<<6|x&63;return A}function We(s){var l=new Uint8Array(s),o="",h;for(h=0;h<l.length;h+=3)o+=p[l[h]>>2],o+=p[(l[h]&3)<<4|l[h+1]>>4],o+=p[(l[h+1]&15)<<2|l[h+2]>>6],o+=p[l[h+2]&63];return l.length%3===2?o=o.substring(0,o.length-1)+"=":l.length%3===1&&(o=o.substring(0,o.length-2)+"=="),o}function Pt(s,l){var o="";if(s&&(o=lt.call(s)),s&&(o==="[object ArrayBuffer]"||s.buffer&&lt.call(s.buffer)==="[object ArrayBuffer]")){var h,d=O;s instanceof ArrayBuffer?(h=s,d+=N):(h=s.buffer,o==="[object Int8Array]"?d+=U:o==="[object Uint8Array]"?d+=te:o==="[object Uint8ClampedArray]"?d+=oe:o==="[object Int16Array]"?d+=ne:o==="[object Uint16Array]"?d+=fe:o==="[object Int32Array]"?d+=J:o==="[object Uint32Array]"?d+=ye:o==="[object Float32Array]"?d+=Se:o==="[object Float64Array]"?d+=de:l(new Error("Failed to get type for BinaryArray"))),l(d+We(h))}else if(o==="[object Blob]"){var f=new FileReader;f.onload=function(){var b=g+s.type+"~"+We(this.result);l(O+z+b)},f.readAsArrayBuffer(s)}else try{l(JSON.stringify(s))}catch(b){console.error("Couldn't convert value into a JSON string: ",s),l(null,b)}}function _t(s){if(s.substring(0,R)!==O)return JSON.parse(s);var l=s.substring(Ae),o=s.substring(R,Ae),h;if(o===z&&C.test(l)){var d=l.match(C);h=d[1],l=l.substring(d[0].length)}var f=ut(l);switch(o){case N:return f;case z:return G([f],{type:h});case U:return new Int8Array(f);case te:return new Uint8Array(f);case oe:return new Uint8ClampedArray(f);case ne:return new Int16Array(f);case fe:return new Uint16Array(f);case J:return new Int32Array(f);case ye:return new Uint32Array(f);case Se:return new Float32Array(f);case de:return new Float64Array(f);default:throw new Error("Unkown type: "+o)}}var Je={serialize:Pt,deserialize:_t,stringToBuffer:ut,bufferToString:We};function ft(s,l,o,h){s.executeSql("CREATE TABLE IF NOT EXISTS "+l.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],o,h)}function Et(s){var l=this,o={db:null};if(s)for(var h in s)o[h]=typeof s[h]!="string"?s[h].toString():s[h];var d=new P(function(f,b){try{o.db=openDatabase(o.name,String(o.version),o.description,o.size)}catch(S){return b(S)}o.db.transaction(function(S){ft(S,o,function(){l._dbInfo=o,f()},function(x,A){b(A)})},b)});return o.serializer=Je,d}function Ce(s,l,o,h,d,f){s.executeSql(o,h,d,function(b,S){S.code===S.SYNTAX_ERR?b.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[l.storeName],function(x,A){A.rows.length?f(x,S):ft(x,l,function(){x.executeSql(o,h,d,f)},f)},f):f(b,S)},f)}function kt(s,l){var o=this;s=re(s);var h=new P(function(d,f){o.ready().then(function(){var b=o._dbInfo;b.db.transaction(function(S){Ce(S,b,"SELECT * FROM "+b.storeName+" WHERE key = ? LIMIT 1",[s],function(x,A){var _=A.rows.length?A.rows.item(0).value:null;_&&(_=b.serializer.deserialize(_)),d(_)},function(x,A){f(A)})})}).catch(f)});return L(h,l),h}function Rt(s,l){var o=this,h=new P(function(d,f){o.ready().then(function(){var b=o._dbInfo;b.db.transaction(function(S){Ce(S,b,"SELECT * FROM "+b.storeName,[],function(x,A){for(var _=A.rows,M=_.length,Y=0;Y<M;Y++){var Z=_.item(Y),ee=Z.value;if(ee&&(ee=b.serializer.deserialize(ee)),ee=s(ee,Z.key,Y+1),ee!==void 0){d(ee);return}}d()},function(x,A){f(A)})})}).catch(f)});return L(h,l),h}function ct(s,l,o,h){var d=this;s=re(s);var f=new P(function(b,S){d.ready().then(function(){l===void 0&&(l=null);var x=l,A=d._dbInfo;A.serializer.serialize(l,function(_,M){M?S(M):A.db.transaction(function(Y){Ce(Y,A,"INSERT OR REPLACE INTO "+A.storeName+" (key, value) VALUES (?, ?)",[s,_],function(){b(x)},function(Z,ee){S(ee)})},function(Y){if(Y.code===Y.QUOTA_ERR){if(h>0){b(ct.apply(d,[s,x,o,h-1]));return}S(Y)}})})}).catch(S)});return L(f,o),f}function Nt(s,l,o){return ct.apply(this,[s,l,o,1])}function Ft(s,l){var o=this;s=re(s);var h=new P(function(d,f){o.ready().then(function(){var b=o._dbInfo;b.db.transaction(function(S){Ce(S,b,"DELETE FROM "+b.storeName+" WHERE key = ?",[s],function(){d()},function(x,A){f(A)})})}).catch(f)});return L(h,l),h}function zt(s){var l=this,o=new P(function(h,d){l.ready().then(function(){var f=l._dbInfo;f.db.transaction(function(b){Ce(b,f,"DELETE FROM "+f.storeName,[],function(){h()},function(S,x){d(x)})})}).catch(d)});return L(o,s),o}function $t(s){var l=this,o=new P(function(h,d){l.ready().then(function(){var f=l._dbInfo;f.db.transaction(function(b){Ce(b,f,"SELECT COUNT(key) as c FROM "+f.storeName,[],function(S,x){var A=x.rows.item(0).c;h(A)},function(S,x){d(x)})})}).catch(d)});return L(o,s),o}function Mt(s,l){var o=this,h=new P(function(d,f){o.ready().then(function(){var b=o._dbInfo;b.db.transaction(function(S){Ce(S,b,"SELECT key FROM "+b.storeName+" WHERE id = ? LIMIT 1",[s+1],function(x,A){var _=A.rows.length?A.rows.item(0).key:null;d(_)},function(x,A){f(A)})})}).catch(f)});return L(h,l),h}function Lt(s){var l=this,o=new P(function(h,d){l.ready().then(function(){var f=l._dbInfo;f.db.transaction(function(b){Ce(b,f,"SELECT key FROM "+f.storeName,[],function(S,x){for(var A=[],_=0;_<x.rows.length;_++)A.push(x.rows.item(_).key);h(A)},function(S,x){d(x)})})}).catch(d)});return L(o,s),o}function Tt(s){return new P(function(l,o){s.transaction(function(h){h.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(d,f){for(var b=[],S=0;S<f.rows.length;S++)b.push(f.rows.item(S).name);l({db:s,storeNames:b})},function(d,f){o(f)})},function(h){o(h)})})}function Bt(s,l){l=he.apply(this,arguments);var o=this.config();s=typeof s!="function"&&s||{},s.name||(s.name=s.name||o.name,s.storeName=s.storeName||o.storeName);var h=this,d;return s.name?d=new P(function(f){var b;s.name===o.name?b=h._dbInfo.db:b=openDatabase(s.name,"","",0),s.storeName?f({db:b,storeNames:[s.storeName]}):f(Tt(b))}).then(function(f){return new P(function(b,S){f.db.transaction(function(x){function A(Z){return new P(function(ee,ae){x.executeSql("DROP TABLE IF EXISTS "+Z,[],function(){ee()},function(se,ge){ae(ge)})})}for(var _=[],M=0,Y=f.storeNames.length;M<Y;M++)_.push(A(f.storeNames[M]));P.all(_).then(function(){b()}).catch(function(Z){S(Z)})},function(x){S(x)})})}):d=P.reject("Invalid arguments"),L(d,l),d}var qt={_driver:"webSQLStorage",_initStorage:Et,_support:u(),iterate:Rt,getItem:kt,setItem:Nt,removeItem:Ft,clear:zt,length:$t,key:Mt,keys:Lt,dropInstance:Bt};function Vt(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function ht(s,l){var o=s.name+"/";return s.storeName!==l.storeName&&(o+=s.storeName+"/"),o}function jt(){var s="_localforage_support_test";try{return localStorage.setItem(s,!0),localStorage.removeItem(s),!1}catch{return!0}}function Ut(){return!jt()||localStorage.length>0}function Wt(s){var l=this,o={};if(s)for(var h in s)o[h]=s[h];return o.keyPrefix=ht(s,l._defaultConfig),Ut()?(l._dbInfo=o,o.serializer=Je,P.resolve()):P.reject()}function Jt(s){var l=this,o=l.ready().then(function(){for(var h=l._dbInfo.keyPrefix,d=localStorage.length-1;d>=0;d--){var f=localStorage.key(d);f.indexOf(h)===0&&localStorage.removeItem(f)}});return L(o,s),o}function Kt(s,l){var o=this;s=re(s);var h=o.ready().then(function(){var d=o._dbInfo,f=localStorage.getItem(d.keyPrefix+s);return f&&(f=d.serializer.deserialize(f)),f});return L(h,l),h}function Ht(s,l){var o=this,h=o.ready().then(function(){for(var d=o._dbInfo,f=d.keyPrefix,b=f.length,S=localStorage.length,x=1,A=0;A<S;A++){var _=localStorage.key(A);if(_.indexOf(f)===0){var M=localStorage.getItem(_);if(M&&(M=d.serializer.deserialize(M)),M=s(M,_.substring(b),x++),M!==void 0)return M}}});return L(h,l),h}function Yt(s,l){var o=this,h=o.ready().then(function(){var d=o._dbInfo,f;try{f=localStorage.key(s)}catch{f=null}return f&&(f=f.substring(d.keyPrefix.length)),f});return L(h,l),h}function Gt(s){var l=this,o=l.ready().then(function(){for(var h=l._dbInfo,d=localStorage.length,f=[],b=0;b<d;b++){var S=localStorage.key(b);S.indexOf(h.keyPrefix)===0&&f.push(S.substring(h.keyPrefix.length))}return f});return L(o,s),o}function Qt(s){var l=this,o=l.keys().then(function(h){return h.length});return L(o,s),o}function Xt(s,l){var o=this;s=re(s);var h=o.ready().then(function(){var d=o._dbInfo;localStorage.removeItem(d.keyPrefix+s)});return L(h,l),h}function Zt(s,l,o){var h=this;s=re(s);var d=h.ready().then(function(){l===void 0&&(l=null);var f=l;return new P(function(b,S){var x=h._dbInfo;x.serializer.serialize(l,function(A,_){if(_)S(_);else try{localStorage.setItem(x.keyPrefix+s,A),b(f)}catch(M){(M.name==="QuotaExceededError"||M.name==="NS_ERROR_DOM_QUOTA_REACHED")&&S(M),S(M)}})})});return L(d,o),d}function er(s,l){if(l=he.apply(this,arguments),s=typeof s!="function"&&s||{},!s.name){var o=this.config();s.name=s.name||o.name,s.storeName=s.storeName||o.storeName}var h=this,d;return s.name?d=new P(function(f){s.storeName?f(ht(s,h._defaultConfig)):f(s.name+"/")}).then(function(f){for(var b=localStorage.length-1;b>=0;b--){var S=localStorage.key(b);S.indexOf(f)===0&&localStorage.removeItem(S)}}):d=P.reject("Invalid arguments"),L(d,l),d}var tr={_driver:"localStorageWrapper",_initStorage:Wt,_support:Vt(),iterate:Ht,getItem:Kt,setItem:Zt,removeItem:Xt,clear:Jt,length:Qt,key:Yt,keys:Gt,dropInstance:er},rr=function(l,o){return l===o||typeof l=="number"&&typeof o=="number"&&isNaN(l)&&isNaN(o)},ir=function(l,o){for(var h=l.length,d=0;d<h;){if(rr(l[d],o))return!0;d++}return!1},dt=Array.isArray||function(s){return Object.prototype.toString.call(s)==="[object Array]"},Fe={},pt={},Ee={INDEXEDDB:a,WEBSQL:qt,LOCALSTORAGE:tr},nr=[Ee.INDEXEDDB._driver,Ee.WEBSQL._driver,Ee.LOCALSTORAGE._driver],Be=["dropInstance"],Ke=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Be),sr={description:"",driver:nr.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function ar(s,l){s[l]=function(){var o=arguments;return s.ready().then(function(){return s[l].apply(s,o)})}}function He(){for(var s=1;s<arguments.length;s++){var l=arguments[s];if(l)for(var o in l)l.hasOwnProperty(o)&&(dt(l[o])?arguments[0][o]=l[o].slice():arguments[0][o]=l[o])}return arguments[0]}var or=function(){function s(l){$(this,s);for(var o in Ee)if(Ee.hasOwnProperty(o)){var h=Ee[o],d=h._driver;this[o]=d,Fe[d]||this.defineDriver(h)}this._defaultConfig=He({},sr),this._config=He({},this._defaultConfig,l),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return s.prototype.config=function(o){if((typeof o>"u"?"undefined":E(o))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var h in o){if(h==="storeName"&&(o[h]=o[h].replace(/\W/g,"_")),h==="version"&&typeof o[h]!="number")return new Error("Database version must be a number.");this._config[h]=o[h]}return"driver"in o&&o.driver?this.setDriver(this._config.driver):!0}else return typeof o=="string"?this._config[o]:this._config},s.prototype.defineDriver=function(o,h,d){var f=new P(function(b,S){try{var x=o._driver,A=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!o._driver){S(A);return}for(var _=Ke.concat("_initStorage"),M=0,Y=_.length;M<Y;M++){var Z=_[M],ee=!ir(Be,Z);if((ee||o[Z])&&typeof o[Z]!="function"){S(A);return}}var ae=function(){for(var ze=function(fr){return function(){var cr=new Error("Method "+fr+" is not implemented by the current driver"),vt=P.reject(cr);return L(vt,arguments[arguments.length-1]),vt}},Ye=0,ur=Be.length;Ye<ur;Ye++){var Ge=Be[Ye];o[Ge]||(o[Ge]=ze(Ge))}};ae();var se=function(ze){Fe[x]&&console.info("Redefining LocalForage driver: "+x),Fe[x]=o,pt[x]=ze,b()};"_support"in o?o._support&&typeof o._support=="function"?o._support().then(se,S):se(!!o._support):se(!0)}catch(ge){S(ge)}});return W(f,h,d),f},s.prototype.driver=function(){return this._driver||null},s.prototype.getDriver=function(o,h,d){var f=Fe[o]?P.resolve(Fe[o]):P.reject(new Error("Driver not found."));return W(f,h,d),f},s.prototype.getSerializer=function(o){var h=P.resolve(Je);return W(h,o),h},s.prototype.ready=function(o){var h=this,d=h._driverSet.then(function(){return h._ready===null&&(h._ready=h._initDriver()),h._ready});return W(d,o,o),d},s.prototype.setDriver=function(o,h,d){var f=this;dt(o)||(o=[o]);var b=this._getSupportedDrivers(o);function S(){f._config.driver=f.driver()}function x(M){return f._extend(M),S(),f._ready=f._initStorage(f._config),f._ready}function A(M){return function(){var Y=0;function Z(){for(;Y<M.length;){var ee=M[Y];return Y++,f._dbInfo=null,f._ready=null,f.getDriver(ee).then(x).catch(Z)}S();var ae=new Error("No available storage method found.");return f._driverSet=P.reject(ae),f._driverSet}return Z()}}var _=this._driverSet!==null?this._driverSet.catch(function(){return P.resolve()}):P.resolve();return this._driverSet=_.then(function(){var M=b[0];return f._dbInfo=null,f._ready=null,f.getDriver(M).then(function(Y){f._driver=Y._driver,S(),f._wrapLibraryMethodsWithReady(),f._initDriver=A(b)})}).catch(function(){S();var M=new Error("No available storage method found.");return f._driverSet=P.reject(M),f._driverSet}),W(this._driverSet,h,d),this._driverSet},s.prototype.supports=function(o){return!!pt[o]},s.prototype._extend=function(o){He(this,o)},s.prototype._getSupportedDrivers=function(o){for(var h=[],d=0,f=o.length;d<f;d++){var b=o[d];this.supports(b)&&h.push(b)}return h},s.prototype._wrapLibraryMethodsWithReady=function(){for(var o=0,h=Ke.length;o<h;o++)ar(this,Ke[o])},s.prototype.createInstance=function(o){return new s(o)},s}(),lr=new or;y.exports=lr},{3:3}]},{},[4])(4)})});var nt=Qe((it,Ct)=>{"use strict";(function(D,m){typeof define=="function"&&define.amd?define([],m):typeof it=="object"?Ct.exports=m():D.LokiIndexedAdapter=m()})(it,function(){return function(){function D(c,v){if(this.app="loki",this.options=v||{},typeof c<"u"&&(this.app=c),this.catalog=null,!this.checkAvailability())throw new Error("indexedDB does not seem to be supported for your environment")}D.prototype.closeDatabase=function(){this.catalog&&this.catalog.db&&(this.catalog.db.close(),this.catalog.db=null)},D.prototype.checkAvailability=function(){return!!(typeof indexedDB<"u"&&indexedDB)},D.prototype.loadDatabase=function(c,v){var y=this.app,w=this;if(this.catalog===null||this.catalog.db===null){this.catalog=new m(function(E){w.catalog=E,w.loadDatabase(c,v)});return}this.catalog.getAppKey(y,c,function(E){if(typeof v=="function"){if(E.id===0){v(null);return}v(E.val)}else console.log(E.val)})},D.prototype.loadKey=D.prototype.loadDatabase,D.prototype.saveDatabase=function(c,v,y){var w=this.app,E=this;function $(T){T&&T.success===!0?y(null):y(new Error("Error saving database")),E.options.closeAfterSave&&E.closeDatabase()}if(this.catalog===null||this.catalog.db===null){this.catalog=new m(function(T){E.saveDatabase(c,v,$)});return}this.catalog.setAppKey(w,c,v,$)},D.prototype.saveKey=D.prototype.saveDatabase,D.prototype.deleteDatabase=function(c,v){var y=this.app,w=this;if(this.catalog===null||this.catalog.db===null){this.catalog=new m(function(E){w.catalog=E,w.deleteDatabase(c,v)});return}this.catalog.getAppKey(y,c,function(E){var $=E.id;$!==0?w.catalog.deleteAppKey($,v):typeof v=="function"&&v({success:!0})})},D.prototype.deleteKey=D.prototype.deleteDatabase,D.prototype.deleteDatabasePartitions=function(c){var v=this;this.getDatabaseList(function(y){y.forEach(function(w){w.startsWith(c)&&v.deleteDatabase(w)})})},D.prototype.getDatabaseList=function(c){var v=this.app,y=this;if(this.catalog===null||this.catalog.db===null){this.catalog=new m(function(w){y.catalog=w,y.getDatabaseList(c)});return}this.catalog.getAppKeys(v,function(w){for(var E=[],$=0;$<w.length;$++)E.push(w[$].key);typeof c=="function"?c(E):E.forEach(function(T){console.log(T)})})},D.prototype.getKeyList=D.prototype.getDatabaseList,D.prototype.getCatalogSummary=function(c){var v=this.app,y=this;if(this.catalog===null||this.catalog.db===null){this.catalog=new m(function(w){y.catalog=w,y.getCatalogSummary(c)});return}this.catalog.getAllKeys(function(w){for(var E=[],$,T,Q,q,G,P=0;P<w.length;P++)$=w[P],Q=$.app||"",q=$.key||"",G=$.val||"",T=Q.length*2+q.length*2+G.length+1,E.push({app:$.app,key:$.key,size:T});typeof c=="function"?c(E):E.forEach(function(L){console.log(L)})})};function m(c){this.db=null,this.initializeLokiCatalog(c)}return m.prototype.initializeLokiCatalog=function(c){var v=indexedDB.open("LokiCatalog",1),y=this;v.onupgradeneeded=function(w){var E=w.target.result;if(E.objectStoreNames.contains("LokiAKV")&&E.deleteObjectStore("LokiAKV"),!E.objectStoreNames.contains("LokiAKV")){var $=E.createObjectStore("LokiAKV",{keyPath:"id",autoIncrement:!0});$.createIndex("app","app",{unique:!1}),$.createIndex("key","key",{unique:!1}),$.createIndex("appkey","appkey",{unique:!0})}},v.onsuccess=function(w){y.db=w.target.result,typeof c=="function"&&c(y)},v.onerror=function(w){throw w}},m.prototype.getAppKey=function(c,v,y){var w=this.db.transaction(["LokiAKV"],"readonly"),E=w.objectStore("LokiAKV"),$=E.index("appkey"),T=c+","+v,Q=$.get(T);Q.onsuccess=function(q){return function(G){var P=G.target.result;(P===null||typeof P>"u")&&(P={id:0,success:!1}),typeof q=="function"?q(P):console.log(P)}}(y),Q.onerror=function(q){return function(G){if(typeof q=="function")q({id:0,success:!1});else throw G}}(y)},m.prototype.getAppKeyById=function(c,v,y){var w=this.db.transaction(["LokiAKV"],"readonly"),E=w.objectStore("LokiAKV"),$=E.get(c);$.onsuccess=function(T,Q){return function(q){typeof Q=="function"?Q(q.target.result,T):console.log(q.target.result)}}(y,v)},m.prototype.setAppKey=function(c,v,y,w){var E=this.db.transaction(["LokiAKV"],"readwrite"),$=E.objectStore("LokiAKV"),T=$.index("appkey"),Q=c+","+v,q=T.get(Q);q.onsuccess=function(G){var P=G.target.result;P==null?P={app:c,key:v,appkey:c+","+v,val:y}:P.val=y;var L=$.put(P);L.onerror=function(W){return function(re){typeof W=="function"?W({success:!1}):(console.error("LokiCatalog.setAppKey (set) onerror"),console.error(q.error))}}(w),L.onsuccess=function(W){return function(re){typeof W=="function"&&W({success:!0})}}(w)},q.onerror=function(G){return function(P){typeof G=="function"?G({success:!1}):(console.error("LokiCatalog.setAppKey (get) onerror"),console.error(q.error))}}(w)},m.prototype.deleteAppKey=function(c,v){var y=this.db.transaction(["LokiAKV"],"readwrite"),w=y.objectStore("LokiAKV"),E=w.delete(c);E.onsuccess=function($){return function(T){typeof $=="function"&&$({success:!0})}}(v),E.onerror=function($){return function(T){typeof $=="function"?$({success:!1}):(console.error("LokiCatalog.deleteAppKey raised onerror"),console.error(E.error))}}(v)},m.prototype.getAppKeys=function(c,v){var y=this.db.transaction(["LokiAKV"],"readonly"),w=y.objectStore("LokiAKV"),E=w.index("app"),$=IDBKeyRange.only(c),T=E.openCursor($),Q=[];T.onsuccess=function(q,G){return function(P){var L=P.target.result;if(L){var W=L.value;q.push(W),L.continue()}else typeof G=="function"?G(q):console.log(q)}}(Q,v),T.onerror=function(q){return function(G){typeof q=="function"?q(null):(console.error("LokiCatalog.getAppKeys raised onerror"),console.error(G))}}(v)},m.prototype.getAllKeys=function(c){var v=this.db.transaction(["LokiAKV"],"readonly"),y=v.objectStore("LokiAKV"),w=y.openCursor(),E=[];w.onsuccess=function($,T){return function(Q){var q=Q.target.result;if(q){var G=q.value;$.push(G),q.continue()}else typeof T=="function"?T($):console.log($)}}(E,c),w.onerror=function($){return function(T){typeof $=="function"&&$(null)}}(c)},D}()})});var Ot=Qe((st,Dt)=>{"use strict";(function(D,m){typeof define=="function"&&define.amd?define([],m):typeof st=="object"?Dt.exports=m():D.loki=m()})(st,function(){return function(){"use strict";var D=Object.prototype.hasOwnProperty;function m(e){var t,r;if(Array.isArray(e)){for(r=0;r<e.length;r++)m(e[r]);c(e)}else if(e!==null&&typeof e=="object"){for(t in e)e.hasOwnProperty(t)&&m(e[t]);c(e)}}function c(e){Object.isFrozen(e)||Object.freeze(e)}function v(e){return Object.isFrozen(e)?K(e,"shallow"):e}var y={copyProperties:function(e,t){var r;for(r in e)t[r]=e[r]},resolveTransformObject:function(e,t,r){var i,n;if(typeof r!="number"&&(r=0),++r>=10)return e;for(i in e)typeof e[i]=="string"&&e[i].indexOf("[%lktxp]")===0?(n=e[i].substring(8),t.hasOwnProperty(n)&&(e[i]=t[n])):typeof e[i]=="object"&&(e[i]=y.resolveTransformObject(e[i],t,r));return e},resolveTransformParams:function(e,t){var r,i,n=[];if(typeof t>"u")return e;for(r=0;r<e.length;r++)i=K(e[r],"shallow-recurse-objects"),n.push(y.resolveTransformObject(i,t));return n},getIn:function(e,t,r){if(e!=null){if(!r)return e[t];if(typeof t=="string"&&(t=t.split(".")),!Array.isArray(t))throw new Error("path must be a string or array. Found "+typeof t);for(var i=0,n=t.length;e!=null&&i<n;)e=e[t[i++]];return i&&i==n?e:void 0}}},w={aeq:E,lt:$,gt:T};function E(e,t){var r,i,n,a;if(e===t)return!0;if(!e||!t||e===!0||t===!0||e!==e||t!==t){switch(e){case void 0:n=1;break;case null:n=1;break;case!1:n=3;break;case!0:n=4;break;case"":n=5;break;default:n=e===e?9:0;break}switch(t){case void 0:a=1;break;case null:a=1;break;case!1:a=3;break;case!0:a=4;break;case"":a=5;break;default:a=t===t?9:0;break}if(n!==9||a!==9)return n===a}return r=Number(e),i=Number(t),r===r||i===i?r===i:(r=e.toString(),i=t.toString(),r==i)}function $(e,t,r){var i,n,a,u;if(!e||!t||e===!0||t===!0||e!==e||t!==t){switch(e){case void 0:a=1;break;case null:a=1;break;case!1:a=3;break;case!0:a=4;break;case"":a=5;break;default:a=e===e?9:0;break}switch(t){case void 0:u=1;break;case null:u=1;break;case!1:u=3;break;case!0:u=4;break;case"":u=5;break;default:u=t===t?9:0;break}if(a!==9||u!==9)return a===u?r:a<u}return i=Number(e),n=Number(t),i===i&&n===n?i<n?!0:i>n?!1:r:i===i&&n!==n?!0:n===n&&i!==i?!1:e<t?!0:e>t?!1:e==t?r:(i=e.toString(),n=t.toString(),i<n?!0:i==n?r:!1)}function T(e,t,r){var i,n,a,u;if(!e||!t||e===!0||t===!0||e!==e||t!==t){switch(e){case void 0:a=1;break;case null:a=1;break;case!1:a=3;break;case!0:a=4;break;case"":a=5;break;default:a=e===e?9:0;break}switch(t){case void 0:u=1;break;case null:u=1;break;case!1:u=3;break;case!0:u=4;break;case"":u=5;break;default:u=t===t?9:0;break}if(a!==9||u!==9)return a===u?r:a>u}return i=Number(e),n=Number(t),i===i&&n===n?i>n?!0:i<n?!1:r:i===i&&n!==n?!1:n===n&&i!==i||e>t?!0:e<t?!1:e==t?r:(i=e.toString(),n=t.toString(),i>n?!0:i==n?r:!1)}function Q(e,t,r){return w.aeq(e,t)?0:w.lt(e,t,!1)?r?1:-1:w.gt(e,t,!1)?r?-1:1:0}function q(e,t,r){for(var i=0,n,a,u,p,g,C,O=0,R=e.length;O<R;O++)if(n=e[O],a=n[0],~a.indexOf(".")?(g=a.split("."),u=y.getIn(t,g,!0),p=y.getIn(r,g,!0)):(u=t[a],p=r[a]),i=Q(u,p,n[1]),i!==0)return i;return 0}function G(e,t,r,i,n,a){var u=a||0,p=t[u],g=!1,C;if(typeof e=="object"&&p in e&&(C=e[p]),u+1>=t.length)g=r(C,i,n);else if(Array.isArray(C))for(var O=0,R=C.length;O<R&&(g=G(C[O],t,r,i,n,u+1),g!==!0);O+=1);else g=G(C,t,r,i,n,u+1);return g}function P(e){return typeof e=="string"||Array.isArray(e)?function(t){return e.indexOf(t)!==-1}:typeof e=="object"&&e!==null?function(t){return D.call(e,t)}:null}function L(e,t,r){for(var i in t)if(D.call(t,i))return W[i](e,t[i],r);return!1}var W={$eq:function(e,t){return e===t},$aeq:function(e,t){return e==t},$ne:function(e,t){return t!==t?e===e:e!==t},$dteq:function(e,t){return w.aeq(e,t)},$gt:function(e,t){return w.gt(e,t,!1)},$gte:function(e,t){return w.gt(e,t,!0)},$lt:function(e,t){return w.lt(e,t,!1)},$lte:function(e,t){return w.lt(e,t,!0)},$jgt:function(e,t){return e>t},$jgte:function(e,t){return e>=t},$jlt:function(e,t){return e<t},$jlte:function(e,t){return e<=t},$between:function(e,t){return e==null?!1:w.gt(e,t[0],!0)&&w.lt(e,t[1],!0)},$jbetween:function(e,t){return e==null?!1:e>=t[0]&&e<=t[1]},$in:function(e,t){return t.indexOf(e)!==-1},$inSet:function(e,t){return t.has(e)},$nin:function(e,t){return t.indexOf(e)===-1},$keyin:function(e,t){return e in t},$nkeyin:function(e,t){return!(e in t)},$definedin:function(e,t){return t[e]!==void 0},$undefinedin:function(e,t){return t[e]===void 0},$regex:function(e,t){return t.test(e)},$containsString:function(e,t){return typeof e=="string"&&e.indexOf(t)!==-1},$containsNone:function(e,t){return!W.$containsAny(e,t)},$containsAny:function(e,t){var r=P(e);return r!==null?Array.isArray(t)?t.some(r):r(t):!1},$contains:function(e,t){var r=P(e);return r!==null?Array.isArray(t)?t.every(r):r(t):!1},$elemMatch:function(e,t){return Array.isArray(e)?e.some(function(r){return Object.keys(t).every(function(i){var n=t[i];return typeof n=="object"&&n||(n={$eq:n}),i.indexOf(".")!==-1?G(r,i.split("."),L,t[i],r):L(r[i],n,r)})}):!1},$type:function(e,t,r){var i=typeof e;return i==="object"&&(Array.isArray(e)?i="array":e instanceof Date&&(i="date")),typeof t!="object"?i===t:L(i,t,r)},$finite:function(e,t){return t===isFinite(e)},$size:function(e,t,r){return Array.isArray(e)?typeof t!="object"?e.length===t:L(e.length,t,r):!1},$len:function(e,t,r){return typeof e=="string"?typeof t!="object"?e.length===t:L(e.length,t,r):!1},$where:function(e,t){return t(e)===!0},$not:function(e,t,r){return!L(e,t,r)},$and:function(e,t,r){for(var i=0,n=t.length;i<n;i+=1)if(!L(e,t[i],r))return!1;return!0},$or:function(e,t,r){for(var i=0,n=t.length;i<n;i+=1)if(L(e,t[i],r))return!0;return!1},$exists:function(e,t){return t?e!==void 0:e===void 0}},re=["$eq","$aeq","$ne","$dteq","$gt","$gte","$lt","$lte","$jgt","$jgte","$jlt","$jlte","$type"];re.forEach(function(e){var t=W[e];W["$"+e]=function(r,i,n){if(typeof i=="string")return t(r,n[i]);if(typeof i=="function")return t(r,i(n));throw new Error("Invalid argument to $$ matcher")}});var he={$eq:W.$eq,$aeq:!0,$dteq:!0,$gt:!0,$gte:!0,$lt:!0,$lte:!0,$in:!0,$between:!0};function K(e,t){if(e==null)return null;var r=t||"parse-stringify",i;switch(r){case"parse-stringify":i=JSON.parse(JSON.stringify(e));break;case"jquery-extend-deep":i=jQuery.extend(!0,{},e);break;case"shallow":i=Object.create(e.constructor.prototype),Object.keys(e).map(function(a){i[a]=e[a]});break;case"shallow-assign":i=Object.create(e.constructor.prototype),Object.assign(i,e);break;case"shallow-recurse-objects":i=K(e,"shallow");var n=Object.keys(e);n.forEach(function(a){typeof e[a]=="object"&&e[a].constructor.name==="Object"?i[a]=K(e[a],"shallow-recurse-objects"):Array.isArray(e[a])&&(i[a]=me(e[a],"shallow-recurse-objects"))});break;default:break}return i}function me(e,t){if(t=="parse-stringify")return K(e,t);for(var r=[],i=0,n=e.length;i<n;i++)r[i]=K(e[i],t);return r}function ie(){try{return window&&window.localStorage!==void 0&&window.localStorage!==null}catch{return!1}}function pe(){}pe.prototype.events={},pe.prototype.asyncListeners=!1,pe.prototype.on=function(e,t){var r,i=this;return Array.isArray(e)?(e.forEach(function(n){i.on(n,t)}),t):(r=this.events[e],r||(r=this.events[e]=[]),r.push(t),t)},pe.prototype.emit=function(e){var t=this,r;if(e&&this.events[e])this.events[e].length&&(r=Array.prototype.slice.call(arguments,1),this.events[e].forEach(function(i){t.asyncListeners?setTimeout(function(){i.apply(t,r)},1):i.apply(t,r)}));else throw new Error("No event "+e+" defined")},pe.prototype.addListener=pe.prototype.on,pe.prototype.removeListener=function(e,t){var r=this;if(Array.isArray(e)){e.forEach(function(n){r.removeListener(n,t)});return}if(this.events[e]){var i=this.events[e];i.splice(i.indexOf(t),1)}};function F(e,t){this.filename=e||"loki.db",this.collections=[],this.databaseVersion=1.5,this.engineVersion=1.5,this.autosave=!1,this.autosaveInterval=5e3,this.autosaveHandle=null,this.throttledSaves=!0,this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,this.throttledSavePending=!1,this.throttledCallbacks=[],this.verbose=t&&t.hasOwnProperty("verbose")?t.verbose:!1,this.events={init:[],loaded:[],flushChanges:[],close:[],changes:[],warning:[]};var r=function(){return typeof global<"u"&&(global.android||global.NSObject)?"NATIVESCRIPT":typeof window>"u"||typeof global<"u"&&global.window&&typeof process<"u"?"NODEJS":typeof document<"u"?document.URL.indexOf("http://")===-1&&document.URL.indexOf("https://")===-1?"CORDOVA":"BROWSER":"CORDOVA"};t&&t.hasOwnProperty("env")?this.ENV=t.env:this.ENV=r(),this.ENV==="undefined"&&(this.ENV="NODEJS"),this.configureOptions(t,!0),this.on("init",this.clearChanges)}F.prototype=new pe,F.prototype.constructor=F,F.prototype.getIndexedAdapter=function(){var e;return typeof De=="function"&&(e=nt()),e},F.prototype.configureOptions=function(e,t){var r={NODEJS:"fs",BROWSER:"localStorage",CORDOVA:"localStorage",MEMORY:"memory"},i={fs:j,localStorage:X,memory:k};if(this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,typeof e<"u"){if(this.options=e,this.options.hasOwnProperty("persistenceMethod")&&typeof i[e.persistenceMethod]=="function"&&(this.persistenceMethod=e.persistenceMethod,this.persistenceAdapter=new i[e.persistenceMethod]),this.options.hasOwnProperty("adapter")&&(this.persistenceMethod="adapter",this.persistenceAdapter=e.adapter,this.options.adapter=null,this.isIncremental=this.persistenceAdapter.mode==="incremental"),e.autoload&&t){var n=this;setTimeout(function(){n.loadDatabase(e,e.autoloadCallback)},1)}this.options.hasOwnProperty("autosaveInterval")&&(this.autosaveDisable(),this.autosaveInterval=parseInt(this.options.autosaveInterval,10)),this.options.hasOwnProperty("autosave")&&this.options.autosave&&(this.autosaveDisable(),this.autosave=!0,this.options.hasOwnProperty("autosaveCallback")?this.autosaveEnable(e,e.autosaveCallback):this.autosaveEnable()),this.options.hasOwnProperty("throttledSaves")&&(this.throttledSaves=this.options.throttledSaves)}this.options.hasOwnProperty("serializationMethod")||(this.options.serializationMethod="normal"),this.options.hasOwnProperty("destructureDelimiter")||(this.options.destructureDelimiter=`$<
`),this.persistenceAdapter===null&&(this.persistenceMethod=r[this.ENV],this.persistenceMethod&&(this.persistenceAdapter=new i[this.persistenceMethod]))},F.prototype.copy=function(e){var t=new F(this.filename,{env:"NA"}),r,i;if(e=e||{},t.loadJSONObject(this,{retainDirtyFlags:!0}),e.hasOwnProperty("removeNonSerializable")&&e.removeNonSerializable===!0)for(t.autosaveHandle=null,t.persistenceAdapter=null,r=t.collections.length,i=0;i<r;i++)t.collections[i].constraints=null,t.collections[i].ttl=null;return t},F.prototype.addCollection=function(e,t){var r,i=this.collections.length;if(t&&t.disableMeta===!0){if(t.disableChangesApi===!1)throw new Error("disableMeta option cannot be passed as true when disableChangesApi is passed as false");if(t.disableDeltaChangesApi===!1)throw new Error("disableMeta option cannot be passed as true when disableDeltaChangesApi is passed as false");if(typeof t.ttl=="number"&&t.ttl>0)throw new Error("disableMeta option cannot be passed as true when ttl is enabled")}for(r=0;r<i;r+=1)if(this.collections[r].name===e)return this.collections[r];var n=new I(e,t);return n.isIncremental=this.isIncremental,this.collections.push(n),this.verbose&&(n.lokiConsoleWrapper=console),n},F.prototype.loadCollection=function(e){if(!e.name)throw new Error("Collection must have a name property to be loaded");this.collections.push(e)},F.prototype.getCollection=function(e){var t,r=this.collections.length;for(t=0;t<r;t+=1)if(this.collections[t].name===e)return this.collections[t];return this.emit("warning","collection "+e+" not found"),null},F.prototype.renameCollection=function(e,t){var r=this.getCollection(e);return r&&(r.name=t),r},F.prototype.listCollections=function(){for(var e=this.collections.length,t=[];e--;)t.push({name:this.collections[e].name,type:this.collections[e].objType,count:this.collections[e].data.length});return t},F.prototype.removeCollection=function(e){var t,r=this.collections.length;for(t=0;t<r;t+=1)if(this.collections[t].name===e){var i=new I(e,{}),n=this.collections[t];for(var a in n)n.hasOwnProperty(a)&&i.hasOwnProperty(a)&&(n[a]=i[a]);this.collections.splice(t,1);return}},F.prototype.getName=function(){return this.name},F.prototype.serializeReplacer=function(e,t){switch(e){case"autosaveHandle":case"persistenceAdapter":case"constraints":case"ttl":return null;case"throttledSavePending":case"throttledCallbacks":return;case"lokiConsoleWrapper":return null;default:return t}},F.prototype.serialize=function(e){switch(e=e||{},e.hasOwnProperty("serializationMethod")||(e.serializationMethod=this.options.serializationMethod),e.serializationMethod){case"normal":return JSON.stringify(this,this.serializeReplacer);case"pretty":return JSON.stringify(this,this.serializeReplacer,2);case"destructured":return this.serializeDestructured();default:return JSON.stringify(this,this.serializeReplacer)}},F.prototype.toJson=F.prototype.serialize,F.prototype.serializeDestructured=function(e){var t,r,i,n,a=[],u;if(e=e||{},e.hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),e.partitioned===!0&&e.hasOwnProperty("partition")&&e.partition>=0)return this.serializeCollection({delimited:e.delimited,delimiter:e.delimiter,collectionIndex:e.partition});for(u=new F(this.filename),u.loadJSONObject(this),t=0;t<u.collections.length;t++)u.collections[t].data=[];if(e.partitioned===!0&&e.partition===-1)return u.serialize({serializationMethod:"normal"});for(a.push(u.serialize({serializationMethod:"normal"})),u=null,t=0;t<this.collections.length;t++)if(i=this.serializeCollection({delimited:e.delimited,delimiter:e.delimiter,collectionIndex:t}),e.partitioned===!1&&e.delimited===!1){if(!Array.isArray(i))throw new Error("a nondelimited, non partitioned collection serialization did not return an expected array");for(n=i.length,r=0;r<n;r++)a.push(i[r]),i[r]=null;a.push("")}else a.push(i);return e.partitioned?(e.delimited,a):e.delimited?(a.push(""),a.join(e.delimiter)):(a.push(""),a)},F.prototype.serializeCollection=function(e){var t,r,i=[];if(e=e||{},e.hasOwnProperty("delimited")||(e.delimited=!0),!e.hasOwnProperty("collectionIndex"))throw new Error("serializeCollection called without 'collectionIndex' option");for(t=this.collections[e.collectionIndex].data.length,i=[],r=0;r<t;r++)i.push(JSON.stringify(this.collections[e.collectionIndex].data[r]));return e.delimited?(i.push(""),i.join(e.delimiter)):i},F.prototype.deserializeDestructured=function(e,t){var r=[],i,n,a,u=0,p,g=1,C=!1,O,R;if(t=t||{},t.hasOwnProperty("partitioned")||(t.partitioned=!1),t.hasOwnProperty("delimited")||(t.delimited=!0),t.hasOwnProperty("delimiter")||(t.delimiter=this.options.destructureDelimiter),t.partitioned){if(t.hasOwnProperty("partition"))return t.partition===-1?(n=JSON.parse(e[0]),n):this.deserializeCollection(e[t.partition+1],t);for(n=JSON.parse(e[0]),p=n.collections.length,u=0;u<p;u++)n.collections[u].data=this.deserializeCollection(e[u+1],t);return n}if(t.delimited){if(r=e.split(t.delimiter),e=null,i=r.length,i===0)return null}else r=e;for(n=JSON.parse(r[0]),p=n.collections.length,r[0]=null;!C;)O=r[g],r[g]===""?++u>p&&(C=!0):(R=JSON.parse(r[g]),n.collections[u].data.push(R)),r[g++]=null;return n},F.prototype.deserializeCollection=function(e,t){var r=[],i,n;for(t=t||{},t.hasOwnProperty("partitioned")||(t.partitioned=!1),t.hasOwnProperty("delimited")||(t.delimited=!0),t.hasOwnProperty("delimiter")||(t.delimiter=this.options.destructureDelimiter),t.delimited?(r=e.split(t.delimiter),r.pop()):r=e,n=r.length,i=0;i<n;i++)r[i]=JSON.parse(r[i]);return r},F.prototype.loadJSON=function(e,t){var r;if(e.length===0)r={};else switch(this.options.serializationMethod){case"normal":case"pretty":r=JSON.parse(e);break;case"destructured":r=this.deserializeDestructured(e);break;default:r=JSON.parse(e);break}this.loadJSONObject(r,t)},F.prototype.loadJSONObject=function(e,t){var r=0,i=e.collections?e.collections.length:0,n,a,u,p,g,C;this.name=e.name,e.hasOwnProperty("throttledSaves")&&t&&!t.hasOwnProperty("throttledSaves")&&(this.throttledSaves=e.throttledSaves),this.collections=[];function O(U){var te=t[U.name],oe;return te.proto?(oe=te.inflate||y.copyProperties,function(ne){var J=new te.proto;return oe(ne,J),J}):te.inflate}for(r;r<i;r+=1){if(n=e.collections[r],a=this.addCollection(n.name,{disableChangesApi:n.disableChangesApi,disableDeltaChangesApi:n.disableDeltaChangesApi,disableMeta:n.disableMeta,disableFreeze:n.hasOwnProperty("disableFreeze")?n.disableFreeze:!0}),a.adaptiveBinaryIndices=n.hasOwnProperty("adaptiveBinaryIndices")?n.adaptiveBinaryIndices===!0:!1,a.transactional=n.transactional,a.asyncListeners=n.asyncListeners,a.cloneObjects=n.cloneObjects,a.cloneMethod=n.cloneMethod||"parse-stringify",a.autoupdate=n.autoupdate,a.changes=n.changes,a.dirtyIds=n.dirtyIds||[],t&&t.retainDirtyFlags===!0?a.dirty=n.dirty:a.dirty=!1,u=n.data.length,p=0,t&&t.hasOwnProperty(n.name))for(g=O(n),p;p<u;p++)C=g(n.data[p]),a.data[p]=C,a.addAutoUpdateObserver(C),a.disableFreeze||m(a.data[p]);else for(p;p<u;p++)a.data[p]=n.data[p],a.addAutoUpdateObserver(a.data[p]),a.disableFreeze||m(a.data[p]);if(a.maxId=typeof n.maxId>"u"?0:n.maxId,typeof n.binaryIndices<"u"&&(a.binaryIndices=n.binaryIndices),typeof n.transforms<"u"&&(a.transforms=n.transforms),a.uniqueNames=[],n.hasOwnProperty("uniqueNames")&&(a.uniqueNames=n.uniqueNames),!(typeof n.DynamicViews>"u")){for(var R=0;R<n.DynamicViews.length;R++){var N=n.DynamicViews[R],z=a.addDynamicView(N.name,N.options);z.resultdata=N.resultdata,z.resultsdirty=N.resultsdirty,z.filterPipeline=N.filterPipeline,z.sortCriteriaSimple=N.sortCriteriaSimple,z.sortCriteria=N.sortCriteria,z.sortFunction=null,z.sortDirty=N.sortDirty,a.disableFreeze||(m(z.filterPipeline),z.sortCriteriaSimple?m(z.sortCriteriaSimple):z.sortCriteria&&m(z.sortCriteria)),z.resultset.filteredrows=N.resultset.filteredrows,z.resultset.filterInitialized=N.resultset.filterInitialized,z.rematerialize({removeWhereFilters:!0})}e.databaseVersion<1.5&&(a.ensureAllIndexes(!0),a.dirty=!0)}}},F.prototype.close=function(e){this.autosave&&(this.autosaveDisable(),this.autosaveDirty()&&(this.saveDatabase(e),e=void 0)),e&&this.on("close",e),this.emit("close")},F.prototype.generateChangesNotification=function(e){function t(n){return n.name}var r=[],i=e||this.collections.map(t);return this.collections.forEach(function(n){i.indexOf(t(n))!==-1&&(r=r.concat(n.getChanges()))}),r},F.prototype.serializeChanges=function(e){return JSON.stringify(this.generateChangesNotification(e))},F.prototype.clearChanges=function(){this.collections.forEach(function(e){e.flushChanges&&e.flushChanges()})};function k(e){this.hashStore={},this.options=e||{},this.options.hasOwnProperty("asyncResponses")||(this.options.asyncResponses=!1),this.options.hasOwnProperty("asyncTimeout")||(this.options.asyncTimeout=50)}k.prototype.loadDatabase=function(e,t){var r=this;this.options.asyncResponses?setTimeout(function(){r.hashStore.hasOwnProperty(e)?t(r.hashStore[e].value):t(null)},this.options.asyncTimeout):this.hashStore.hasOwnProperty(e)?t(this.hashStore[e].value):t(null)},k.prototype.saveDatabase=function(e,t,r){var i=this,n;this.options.asyncResponses?setTimeout(function(){n=i.hashStore.hasOwnProperty(e)?i.hashStore[e].savecount:0,i.hashStore[e]={savecount:n+1,lastsave:new Date,value:t},r()},this.options.asyncTimeout):(n=this.hashStore.hasOwnProperty(e)?this.hashStore[e].savecount:0,this.hashStore[e]={savecount:n+1,lastsave:new Date,value:t},r())},k.prototype.deleteDatabase=function(e,t){this.hashStore.hasOwnProperty(e)&&delete this.hashStore[e],typeof t=="function"&&t()};function H(e,t){if(this.mode="reference",this.adapter=null,this.options=t||{},this.dbref=null,this.dbname="",this.pageIterator={},e){if(e.mode==="reference")throw new Error("LokiPartitioningAdapter cannot be instantiated with a reference mode adapter");this.adapter=e}else throw new Error("LokiPartitioningAdapter requires a (non-reference mode) adapter on construction");this.options.hasOwnProperty("paging")||(this.options.paging=!1),this.options.hasOwnProperty("pageSize")||(this.options.pageSize=25*1024*1024),this.options.hasOwnProperty("delimiter")||(this.options.delimiter=`$<
`)}H.prototype.loadDatabase=function(e,t){var r=this;this.dbname=e,this.dbref=new F(e),this.adapter.loadDatabase(e,function(i){if(!i){t(i);return}typeof i!="string"&&t(new Error("LokiPartitioningAdapter received an unexpected response from inner adapter loadDatabase()"));var n=JSON.parse(i);r.dbref.loadJSONObject(n),n=null;var a=r.dbref.collections.length;if(r.dbref.collections.length===0){t(r.dbref);return}r.pageIterator={collection:0,pageIndex:0},r.loadNextPartition(0,function(){t(r.dbref)})})},H.prototype.loadNextPartition=function(e,t){var r=this.dbname+"."+e,i=this;if(this.options.paging===!0){this.pageIterator.pageIndex=0,this.loadNextPage(t);return}this.adapter.loadDatabase(r,function(n){var a=i.dbref.deserializeCollection(n,{delimited:!0,collectionIndex:e});i.dbref.collections[e].data=a,++e<i.dbref.collections.length?i.loadNextPartition(e,t):t()})},H.prototype.loadNextPage=function(e){var t=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,r=this;this.adapter.loadDatabase(t,function(i){var n=i.split(r.options.delimiter);i="";var a=n.length,u,p=n[a-1]==="";for(p&&(n.pop(),a=n.length,n[a-1]===""&&a===1&&(n.pop(),a=n.length)),u=0;u<a;u++)r.dbref.collections[r.pageIterator.collection].data.push(JSON.parse(n[u])),n[u]=null;n=[],p?++r.pageIterator.collection<r.dbref.collections.length?r.loadNextPartition(r.pageIterator.collection,e):e():(r.pageIterator.pageIndex++,r.loadNextPage(e))})},H.prototype.exportDatabase=function(e,t,r){var i=this,n,a=t.collections.length;for(this.dbref=t,this.dbname=e,this.dirtyPartitions=[-1],n=0;n<a;n++)t.collections[n].dirty&&this.dirtyPartitions.push(n);this.saveNextPartition(function(u){r(u)})},H.prototype.saveNextPartition=function(e){var t=this,r=this.dirtyPartitions.shift(),i=this.dbname+(r===-1?"":"."+r);if(this.options.paging&&r!==-1){this.pageIterator={collection:r,docIndex:0,pageIndex:0},this.saveNextPage(function(a){t.dirtyPartitions.length===0?e(a):t.saveNextPartition(e)});return}var n=this.dbref.serializeDestructured({partitioned:!0,delimited:!0,partition:r});this.adapter.saveDatabase(i,n,function(a){if(a){e(a);return}t.dirtyPartitions.length===0?e(null):t.saveNextPartition(e)})},H.prototype.saveNextPage=function(e){var t=this,r=this.dbref.collections[this.pageIterator.collection],i=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,n=0,a=r.data.length,u=this.options.delimiter.length,p="",g="",C=!1,O=!1,R=function(N){g="",N&&e(N),C?e(null):(t.pageIterator.pageIndex++,t.saveNextPage(e))};for(r.data.length===0&&(C=!0);;)if(C||(p=JSON.stringify(r.data[this.pageIterator.docIndex]),g+=p,n+=p.length,++this.pageIterator.docIndex>=a&&(C=!0)),n>=this.options.pageSize&&(O=!0),(!O||C)&&(g+=this.options.delimiter,n+=u),C||O){this.adapter.saveDatabase(i,g,R);return}};function j(){try{this.fs=De("fs")}catch{this.fs=null}}j.prototype.loadDatabase=function(t,r){var i=this;this.fs.stat(t,function(n,a){!n&&a.isFile()?i.fs.readFile(t,{encoding:"utf8"},function(p,g){r(p?new Error(p):g)}):r(null)})},j.prototype.saveDatabase=function(t,r,i){var n=this,a=t+"~";this.fs.writeFile(a,r,function(p){p?i(new Error(p)):n.fs.rename(a,t,i)})},j.prototype.deleteDatabase=function(t,r){this.fs.unlink(t,function(n){n?r(new Error(n)):r()})};function X(){}X.prototype.loadDatabase=function(t,r){ie()?r(localStorage.getItem(t)):r(new Error("localStorage is not available"))},X.prototype.saveDatabase=function(t,r,i){ie()?(localStorage.setItem(t,r),i(null)):i(new Error("localStorage is not available"))},X.prototype.deleteDatabase=function(t,r){ie()?(localStorage.removeItem(t),r(null)):r(new Error("localStorage is not available"))},F.prototype.throttledSaveDrain=function(e,t){var r=this,i=new Date().getTime();if(this.throttledSaves||e(!0),t=t||{},t.hasOwnProperty("recursiveWait")||(t.recursiveWait=!0),t.hasOwnProperty("recursiveWaitLimit")||(t.recursiveWaitLimit=!1),t.hasOwnProperty("recursiveWaitLimitDuration")||(t.recursiveWaitLimitDuration=2e3),t.hasOwnProperty("started")||(t.started=new Date().getTime()),this.throttledSaves&&this.throttledSavePending)if(t.recursiveWait)this.throttledCallbacks.push(function(){if(r.throttledSavePending){if(t.recursiveWaitLimit&&i-t.started>t.recursiveWaitLimitDuration){e(!1);return}r.throttledSaveDrain(e,t);return}else{e(!0);return}});else{this.throttledCallbacks.push(e);return}else e(!0)},F.prototype.loadDatabaseInternal=function(e,t){var r=t||function(n,a){if(n)throw n},i=this;this.persistenceAdapter!==null?this.persistenceAdapter.loadDatabase(this.filename,function(a){if(typeof a=="string"){var u=!1;try{i.loadJSON(a,e||{}),u=!0}catch(p){r(p)}u&&(r(null),i.emit("loaded","database "+i.filename+" loaded"))}else{if(!a){r(null),i.emit("loaded","empty database "+i.filename+" loaded");return}if(a instanceof Error){r(a);return}if(typeof a=="object"){i.loadJSONObject(a,e||{}),r(null),i.emit("loaded","database "+i.filename+" loaded");return}r("unexpected adapter response : "+a)}}):r(new Error("persistenceAdapter not configured"))},F.prototype.loadDatabase=function(e,t){var r=this;if(!this.throttledSaves){this.loadDatabaseInternal(e,t);return}this.throttledSaveDrain(function(i){if(i){r.throttledSavePending=!0,r.loadDatabaseInternal(e,function(n){r.throttledCallbacks.length===0?r.throttledSavePending=!1:r.saveDatabase(),typeof t=="function"&&t(n)});return}else typeof t=="function"&&t(new Error("Unable to pause save throttling long enough to read database"))},e)},F.prototype.saveDatabaseInternal=function(e){var t=e||function(n){if(n)throw n},r=this;if(!this.persistenceAdapter){t(new Error("persistenceAdapter not configured"));return}if(this.persistenceAdapter.mode==="incremental"){var i;this.ignoreAutosave=!0,this.persistenceAdapter.saveDatabase(this.filename,function(){if(r.ignoreAutosave=!1,i){t(new Error("adapter error - getLokiCopy called more than once"));return}var a=r.copy({removeNonSerializable:!0});return i=r.collections.map(function(u){return[u.dirty,u.dirtyIds]}),r.collections.forEach(function(u){u.dirty=!1,u.dirtyIds=[]}),a},function(a){r.ignoreAutosave=!1,a&&i&&r.collections.forEach(function(u,p){var g=i[p];u.dirty=u.dirty||g[0],u.dirtyIds=u.dirtyIds.concat(g[1])}),t(a)})}else this.persistenceAdapter.mode==="reference"&&typeof this.persistenceAdapter.exportDatabase=="function"?this.persistenceAdapter.exportDatabase(this.filename,this.copy({removeNonSerializable:!0}),function(a){r.autosaveClearFlags(),t(a)}):(this.autosaveClearFlags(),this.persistenceAdapter.saveDatabase(this.filename,this.serialize(),function(a){t(a)}))},F.prototype.saveDatabase=function(e){if(!this.throttledSaves){this.saveDatabaseInternal(e);return}if(this.throttledSavePending){this.throttledCallbacks.push(e);return}var t=this.throttledCallbacks;this.throttledCallbacks=[],t.unshift(e),this.throttledSavePending=!0;var r=this;this.saveDatabaseInternal(function(i){r.throttledSavePending=!1,t.forEach(function(n){typeof n=="function"&&setTimeout(function(){n(i)},1)}),r.throttledCallbacks.length>0&&r.saveDatabase()})},F.prototype.save=F.prototype.saveDatabase,F.prototype.deleteDatabase=function(e,t){var r=t||function(i,n){if(i)throw i};typeof e=="function"&&!t&&(r=e),this.persistenceAdapter!==null?this.persistenceAdapter.deleteDatabase(this.filename,function(n){r(n)}):r(new Error("persistenceAdapter not configured"))},F.prototype.autosaveDirty=function(){for(var e=0;e<this.collections.length;e++)if(this.collections[e].dirty)return!0;return!1},F.prototype.autosaveClearFlags=function(){for(var e=0;e<this.collections.length;e++)this.collections[e].dirty=!1},F.prototype.autosaveEnable=function(e,t){this.autosave=!0;var r=5e3,i=this;typeof this.autosaveInterval<"u"&&this.autosaveInterval!==null&&(r=this.autosaveInterval),this.autosaveHandle=setInterval(function(){i.autosaveDirty()&&!i.ignoreAutosave&&i.saveDatabase(t)},r)},F.prototype.autosaveDisable=function(){typeof this.autosaveHandle<"u"&&this.autosaveHandle!==null&&(clearInterval(this.autosaveHandle),this.autosaveHandle=null)};function B(e,t){return t=t||{},this.collection=e,this.filteredrows=[],this.filterInitialized=!1,this}B.prototype.reset=function(){return this.filteredrows.length>0&&(this.filteredrows=[]),this.filterInitialized=!1,this},B.prototype.toJSON=function(){var e=this.copy();return e.collection=null,e},B.prototype.limit=function(e){!this.filterInitialized&&this.filteredrows.length===0&&(this.filteredrows=this.collection.prepareFullDocIndex());var t=new B(this.collection);return t.filteredrows=this.filteredrows.slice(0,e),t.filterInitialized=!0,t},B.prototype.offset=function(e){!this.filterInitialized&&this.filteredrows.length===0&&(this.filteredrows=this.collection.prepareFullDocIndex());var t=new B(this.collection);return t.filteredrows=this.filteredrows.slice(e),t.filterInitialized=!0,t},B.prototype.copy=function(){var e=new B(this.collection);return this.filteredrows.length>0&&(e.filteredrows=this.filteredrows.slice()),e.filterInitialized=this.filterInitialized,e},B.prototype.branch=B.prototype.copy,B.prototype.transform=function(e,t){var r,i,n=this;if(typeof e=="string"&&this.collection.transforms.hasOwnProperty(e)&&(e=this.collection.transforms[e]),typeof e!="object"||!Array.isArray(e))throw new Error("Invalid transform");for(typeof t<"u"&&(e=y.resolveTransformParams(e,t)),r=0;r<e.length;r++)switch(i=e[r],i.type){case"find":n.find(i.value);break;case"where":n.where(i.value);break;case"simplesort":n.simplesort(i.property,i.desc||i.options);break;case"compoundsort":n.compoundsort(i.value);break;case"sort":n.sort(i.value);break;case"limit":n=n.limit(i.value);break;case"offset":n=n.offset(i.value);break;case"map":n=n.map(i.value,i.dataOptions);break;case"eqJoin":n=n.eqJoin(i.joinData,i.leftJoinKey,i.rightJoinKey,i.mapFun,i.dataOptions);break;case"mapReduce":n=n.mapReduce(i.mapFunction,i.reduceFunction);break;case"update":n.update(i.value);break;case"remove":n.remove();break;default:break}return n},B.prototype.sort=function(e){!this.filterInitialized&&this.filteredrows.length===0&&(this.filteredrows=this.collection.prepareFullDocIndex());var t=function(r,i){return function(n,a){return r(i[n],i[a])}}(e,this.collection.data);return this.filteredrows.sort(t),this},B.prototype.simplesort=function(e,t){var r,i=10,n=this.collection.data.length,a=this.filteredrows.length,u=this.collection.binaryIndices.hasOwnProperty(e);if((typeof t>"u"||t===!1)&&(t={desc:!1}),t===!0&&(t={desc:!0}),a===0){if(this.filterInitialized)return this;if(this.collection.binaryIndices.hasOwnProperty(e))return this.collection.ensureIndex(e),this.filteredrows=this.collection.binaryIndices[e].values.slice(0),t.desc&&this.filteredrows.reverse(),this;this.filteredrows=this.collection.prepareFullDocIndex()}else if(!t.disableIndexIntersect&&u&&(r=n/a,t.useJavascriptSorting&&(i=6),r<=i||t.forceIndexIntersect)){var p,g=this.filteredrows,C={};for(p=0;p<a;p++)C[g[p]]=!0;var O=this.collection.binaryIndices[e].values;return this.filteredrows=O.filter(function(N){return C[N]}),t.desc&&this.filteredrows.reverse(),this}if(t.useJavascriptSorting)return this.sort(function(N,z){if(N[e]===z[e])return 0;if(N[e]>z[e])return 1;if(N[e]<z[e])return-1});var R=function(N,z,U){var te,oe,ne;return function(J,fe){return~N.indexOf(".")?(ne=N.split("."),te=y.getIn(U[J],ne,!0),oe=y.getIn(U[fe],ne,!0)):(te=U[J][N],oe=U[fe][N]),Q(te,oe,z)}}(e,t.desc,this.collection.data);return this.filteredrows.sort(R),this},B.prototype.compoundsort=function(e){if(e.length===0)throw new Error("Invalid call to compoundsort, need at least one property");var t;if(e.length===1)return t=e[0],Array.isArray(t)?this.simplesort(t[0],t[1]):this.simplesort(t,!1);for(var r=0,i=e.length;r<i;r+=1)t=e[r],Array.isArray(t)||(e[r]=[t,!1]);!this.filterInitialized&&this.filteredrows.length===0&&(this.filteredrows=this.collection.prepareFullDocIndex());var n=function(a,u){return function(p,g){return q(a,u[p],u[g])}}(e,this.collection.data);return this.filteredrows.sort(n),this},B.prototype.findOr=function(e){for(var t=null,r=0,i=0,n=[],a=[],u=0,p=this.count(),g=0,C=e.length;g<C;g++)for(t=this.branch().find(e[g]).filteredrows,i=t.length,r=0;r<i;r++)u=t[r],a[u]===void 0&&(a[u]=!0,n.push(u));return this.filteredrows=n,this.filterInitialized=!0,this},B.prototype.$or=B.prototype.findOr;function ce(e,t){if(e==="$regex")Array.isArray(t)?t=new RegExp(t[0],t[1]):t instanceof RegExp||(t=new RegExp(t));else if(typeof t=="object")for(var r in t)(r==="$regex"||typeof t[r]=="object")&&(t[r]=ce(r,t[r]));return t}B.prototype.findAnd=function(e){for(var t=0,r=e.length;t<r;t++){if(this.count()===0)return this;this.find(e[t])}return this},B.prototype.$and=B.prototype.findAnd,B.prototype.find=function(e,t){if(this.collection.data.length===0)return this.filteredrows=[],this.filterInitialized=!0,this;var r=e||"getAll",i,n,a,u,p,g,C,O=!1,R=[],N=[],z=null;if(t=t||!1,typeof r=="object"){for(i in r)u={},u[i]=r[i],N.push(u),D.call(r,i)&&(n=i,a=r[i]);if(N.length>1)return this.find({$and:N},t)}if(!n||r==="getAll")return t&&(this.filterInitialized?this.filteredrows=this.filteredrows.slice(0,1):(this.filteredrows=this.collection.data.length>0?[0]:[],this.filterInitialized=!0)),this;if(n==="$and"||n==="$or")return this[n](a),t&&this.filteredrows.length>1&&(this.filteredrows=this.filteredrows.slice(0,1)),this;if(a===null||typeof a!="object"||a instanceof Date)p="$eq",g=a;else if(typeof a=="object"){for(C in a)if(D.call(a,C)){p=C,g=a[C];break}}else throw new Error("Do not know what you want to do.");(p==="$regex"||typeof g=="object")&&(g=ce(p,g));var U=n.indexOf(".")!==-1,te=!this.filterInitialized;te&&this.collection.binaryIndices[n]&&he[p]&&(this.collection.adaptiveBinaryIndices!==!0&&this.collection.ensureIndex(n),O=!0,z=this.collection.binaryIndices[n]),!O&&p==="$in"&&Array.isArray(g)&&typeof Set<"u"&&(g=new Set(g),p="$inSet");var oe=W[p],ne=this.collection.data,J=0,fe=0,ye,Se=0,de;if(this.filterInitialized){if(ye=this.filteredrows,fe=ye.length,U){for(n=n.split("."),J=0;J<fe;J++)if(Se=ye[J],de=ne[Se],G(de,n,oe,g,de)&&(R.push(Se),t))return this.filteredrows=R,this}else for(J=0;J<fe;J++)if(Se=ye[J],de=ne[Se],oe(de[n],g,de)&&(R.push(Se),t))return this.filteredrows=R,this}else if(O){var Ae=this.collection.calculateRange(p,n,g);if(p!=="$in"){for(J=Ae[0];J<=Ae[1];J++)if(he[p]!==!0){if(he[p](y.getIn(ne[z.values[J]],n,U),g)&&(R.push(z.values[J]),t))return this.filteredrows=R,this.filterInitialized=!0,this}else if(R.push(z.values[J]),t)return this.filteredrows=R,this.filterInitialized=!0,this}else for(J=0,fe=Ae.length;J<fe;J++)if(R.push(z.values[Ae[J]]),t)return this.filteredrows=R,this.filterInitialized=!0,this}else if(fe=ne.length,U){for(n=n.split("."),J=0;J<fe;J++)if(de=ne[J],G(de,n,oe,g,de)&&(R.push(J),t))return this.filteredrows=R,this.filterInitialized=!0,this}else for(J=0;J<fe;J++)if(de=ne[J],oe(de[n],g,de)&&(R.push(J),t))return this.filteredrows=R,this.filterInitialized=!0,this;return this.filteredrows=R,this.filterInitialized=!0,this},B.prototype.where=function(e){var t,r=[];if(typeof e=="function")t=e;else throw new TypeError("Argument is not a stored view or a function");try{if(this.filterInitialized){for(var i=this.filteredrows.length;i--;)t(this.collection.data[this.filteredrows[i]])===!0&&r.push(this.filteredrows[i]);return this.filteredrows=r,this}else{for(var n=this.collection.data.length;n--;)t(this.collection.data[n])===!0&&r.push(n);return this.filteredrows=r,this.filterInitialized=!0,this}}catch(a){throw a}},B.prototype.count=function(){return this.filterInitialized?this.filteredrows.length:this.collection.count()},B.prototype.data=function(e){var t=[],r=this.collection.data,i,n,a,u;if(e=e||{},e.removeMeta&&!e.forceClones&&(e.forceClones=!0,e.forceCloneMethod=e.forceCloneMethod||"shallow"),!this.collection.disableDeltaChangesApi&&this.collection.disableFreeze&&(e.forceClones=!0,e.forceCloneMethod="parse-stringify"),!this.filterInitialized)if(this.filteredrows.length===0)if(this.collection.cloneObjects||e.forceClones){for(n=r.length,u=e.forceCloneMethod||this.collection.cloneMethod,a=0;a<n;a++)i=K(r[a],u),e.removeMeta&&(delete i.$loki,delete i.meta),t.push(i);return t}else return r.slice();else this.filterInitialized=!0;var p=this.filteredrows;if(n=p.length,this.collection.cloneObjects||e.forceClones)for(u=e.forceCloneMethod||this.collection.cloneMethod,a=0;a<n;a++)i=K(r[p[a]],u),e.removeMeta&&(delete i.$loki,delete i.meta),t.push(i);else for(a=0;a<n;a++)t.push(r[p[a]]);return t},B.prototype.update=function(e){if(typeof e!="function")throw new TypeError("Argument is not a function");!this.filterInitialized&&this.filteredrows.length===0&&(this.filteredrows=this.collection.prepareFullDocIndex());for(var t,r=this.filteredrows.length,i=this.collection.data,n=0;n<r;n++)!this.disableFreeze||this.collection.cloneObjects||!this.collection.disableDeltaChangesApi?(t=K(i[this.filteredrows[n]],this.collection.cloneMethod),e(t),this.collection.update(t)):(e(i[this.filteredrows[n]]),this.collection.update(i[this.filteredrows[n]]));return this},B.prototype.remove=function(){return!this.filterInitialized&&this.filteredrows.length===0&&(this.filteredrows=this.collection.prepareFullDocIndex()),this.collection.removeBatchByPositions(this.filteredrows),this.filteredrows=[],this},B.prototype.mapReduce=function(e,t){try{return t(this.data().map(e))}catch(r){throw r}},B.prototype.eqJoin=function(e,t,r,i,n){var a=[],u,p=[],g,C,O=[],R=typeof t=="function",N=typeof r=="function",z={};if(a=this.data(n),u=a.length,e instanceof I)p=e.chain().data(n);else if(e instanceof B)p=e.data(n);else if(Array.isArray(e))p=e;else throw new TypeError("joinData needs to be an array or result set");g=p.length;for(var U=0;U<g;U++)C=N?r(p[U]):p[U][r],z[C]=p[U];i||(i=function(oe,ne){return{left:oe,right:ne}});for(var te=0;te<u;te++)C=R?t(a[te]):a[te][t],O.push(i(a[te],z[C]||{}));return this.collection=new I("joinData"),this.collection.insert(O),this.filteredrows=[],this.filterInitialized=!1,this},B.prototype.map=function(e,t){var r=this.data(t).map(e);return this.collection=new I("mappedData"),this.collection.insert(r),this.filteredrows=[],this.filterInitialized=!1,this};function V(e,t,r){this.collection=e,this.name=t,this.rebuildPending=!1,this.options=r||{},this.options.hasOwnProperty("persistent")||(this.options.persistent=!1),this.options.hasOwnProperty("sortPriority")||(this.options.sortPriority="passive"),this.options.hasOwnProperty("minRebuildInterval")||(this.options.minRebuildInterval=1),this.resultset=new B(e),this.resultdata=[],this.resultsdirty=!1,this.cachedresultset=null,this.filterPipeline=[],this.collection.disableFreeze||Object.freeze(this.filterPipeline),this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,this.events={rebuild:[],filter:[],sort:[]}}V.prototype=new pe,V.prototype.constructor=V,V.prototype.getSort=function(){return this.sortFunction||this.sortCriteria||this.sortCriteriaSimple},V.prototype.rematerialize=function(e){var t,r,i;e=e||{},this.resultdata=[],this.resultsdirty=!0,this.resultset=new B(this.collection),(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple)&&(this.sortDirty=!0);var n=Object.isFrozen(this.filterPipeline);if(e.hasOwnProperty("removeWhereFilters"))for(n&&(this.filterPipeline=this.filterPipeline.slice()),t=this.filterPipeline.length,r=t;r--;)this.filterPipeline[r].type==="where"&&(r!==this.filterPipeline.length-1&&(this.filterPipeline[r]=this.filterPipeline[this.filterPipeline.length-1]),this.filterPipeline.length--);var a=this.filterPipeline;for(this.filterPipeline=[],t=a.length,i=0;i<t;i++)this.applyFind(a[i].val,a[i].uid);return n&&Object.freeze(this.filterPipeline),this.data(),this.emit("rebuild",this),this},V.prototype.branchResultset=function(e,t){var r=this.resultset.branch();return typeof e>"u"?r:r.transform(e,t)},V.prototype.toJSON=function(){var e=new V(this.collection,this.name,this.options);return e.resultset=this.resultset,e.resultdata=[],e.resultsdirty=!0,e.filterPipeline=this.filterPipeline,e.sortFunction=this.sortFunction,e.sortCriteria=this.sortCriteria,e.sortCriteriaSimple=this.sortCriteriaSimple||null,e.sortDirty=this.sortDirty,e.collection=null,e},V.prototype.removeFilters=function(e){e=e||{},this.rebuildPending=!1,this.resultset.reset(),this.resultdata=[],this.resultsdirty=!0,this.cachedresultset=null;var t=Object.isFrozen(this.filterPipeline),r=this.filterPipeline.length>0;this.filterPipeline=[],t&&Object.freeze(this.filterPipeline),this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,e.queueSortPhase===!0&&this.queueSortPhase(),r&&this.emit("filter")},V.prototype.applySort=function(e){return this.sortFunction=e,this.sortCriteria=null,this.sortCriteriaSimple=null,this.queueSortPhase(),this.emit("sort"),this},V.prototype.applySimpleSort=function(e,t){return this.sortCriteriaSimple={propname:e,options:t||!1},this.collection.disableFreeze||m(this.sortCriteriaSimple),this.sortCriteria=null,this.sortFunction=null,this.queueSortPhase(),this.emit("sort"),this},V.prototype.applySortCriteria=function(e){return this.sortCriteria=e,this.collection.disableFreeze||m(this.sortCriteria),this.sortCriteriaSimple=null,this.sortFunction=null,this.queueSortPhase(),this.emit("sort"),this},V.prototype.startTransaction=function(){return this.cachedresultset=this.resultset.copy(),this},V.prototype.commit=function(){return this.cachedresultset=null,this},V.prototype.rollback=function(){return this.resultset=this.cachedresultset,this.options.persistent&&(this.resultdata=this.resultset.data(),this.emit("rebuild",this)),this},V.prototype._indexOfFilterWithId=function(e){if(typeof e=="string"||typeof e=="number"){for(var t=0,r=this.filterPipeline.length;t<r;t+=1)if(e===this.filterPipeline[t].uid)return t}return-1},V.prototype._addFilter=function(e){var t=Object.isFrozen(this.filterPipeline);t&&(this.filterPipeline=this.filterPipeline.slice()),this.collection.disableFreeze||m(e),this.filterPipeline.push(e),t&&Object.freeze(this.filterPipeline),this.resultset[e.type](e.val)},V.prototype.reapplyFilters=function(){this.resultset.reset(),this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0);var e=this.filterPipeline,t=Object.isFrozen(e);this.filterPipeline=[];for(var r=0,i=e.length;r<i;r+=1)this._addFilter(e[r]);return t&&Object.freeze(this.filterPipeline),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this.emit("filter"),this},V.prototype.applyFilter=function(e){var t=this._indexOfFilterWithId(e.uid);if(t>=0){var r=Object.isFrozen(this.filterPipeline);return r&&(this.filterPipeline=this.filterPipeline.slice()),this.filterPipeline[t]=e,r&&(c(e),Object.freeze(this.filterPipeline)),this.reapplyFilters()}return this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0),this._addFilter(e),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this.emit("filter"),this},V.prototype.applyFind=function(e,t){return this.applyFilter({type:"find",val:e,uid:t}),this},V.prototype.applyWhere=function(e,t){return this.applyFilter({type:"where",val:e,uid:t}),this},V.prototype.removeFilter=function(e){var t=this._indexOfFilterWithId(e);if(t<0)throw new Error("Dynamic view does not contain a filter with ID: "+e);var r=Object.isFrozen(this.filterPipeline);return r&&(this.filterPipeline=this.filterPipeline.slice()),this.filterPipeline.splice(t,1),r&&Object.freeze(this.filterPipeline),this.reapplyFilters(),this},V.prototype.count=function(){return this.resultsdirty&&(this.resultdata=this.resultset.data()),this.resultset.count()},V.prototype.data=function(e){return(this.sortDirty||this.resultsdirty)&&this.performSortPhase({suppressRebuildEvent:!0}),this.options.persistent?this.resultdata:this.resultset.data(e)},V.prototype.queueRebuildEvent=function(){if(!this.rebuildPending){this.rebuildPending=!0;var e=this;setTimeout(function(){e.rebuildPending&&(e.rebuildPending=!1,e.emit("rebuild",e))},this.options.minRebuildInterval)}},V.prototype.queueSortPhase=function(){if(!this.sortDirty){this.sortDirty=!0;var e=this;this.options.sortPriority==="active"?setTimeout(function(){e.performSortPhase()},this.options.minRebuildInterval):this.queueRebuildEvent()}},V.prototype.performSortPhase=function(e){!this.sortDirty&&!this.resultsdirty||(e=e||{},this.sortDirty&&(this.sortFunction?this.resultset.sort(this.sortFunction):this.sortCriteria?this.resultset.compoundsort(this.sortCriteria):this.sortCriteriaSimple&&this.resultset.simplesort(this.sortCriteriaSimple.propname,this.sortCriteriaSimple.options),this.sortDirty=!1),this.options.persistent&&(this.resultdata=this.resultset.data(),this.resultsdirty=!1),e.suppressRebuildEvent||this.emit("rebuild",this))},V.prototype.evaluateDocument=function(e,t){if(!this.resultset.filterInitialized){this.options.persistent&&(this.resultdata=this.resultset.data()),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent();return}var r=this.resultset.filteredrows,i=t?-1:r.indexOf(+e),n=r.length,a=new B(this.collection);a.filteredrows=[e],a.filterInitialized=!0;for(var u,p=0,g=this.filterPipeline.length;p<g;p++)u=this.filterPipeline[p],a[u.type](u.val);var C=a.filteredrows.length===0?-1:0;if(!(i===-1&&C===-1)){if(i===-1&&C!==-1){r.push(e),this.options.persistent&&this.resultdata.push(this.collection.data[e]),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent();return}if(i!==-1&&C===-1){i<n-1?(r.splice(i,1),this.options.persistent&&this.resultdata.splice(i,1)):(r.length=n-1,this.options.persistent&&(this.resultdata.length=n-1)),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent();return}if(i!==-1&&C!==-1){this.options.persistent&&(this.resultdata[i]=this.collection.data[e]),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent();return}}},V.prototype.removeDocument=function(e){var t,r,i,n={},a={},u=[],p=this.resultset,g=this.resultset.filteredrows,C=g.length;if(!this.resultset.filterInitialized){this.options.persistent&&(this.resultdata=this.resultset.data()),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent();return}for(Array.isArray(e)||(e=[e]),i=e.length,r=0;r<i;r++)n[e[r]]=!0;for(t=0;t<C;t++)n[g[t]]&&(a[t]=!0);Object.keys(a).length>0&&(this.resultset.filteredrows=this.resultset.filteredrows.filter(function(R,N){return!a[N]}),this.options.persistent&&(this.resultdata=this.resultdata.filter(function(R,N){return!a[N]})),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var O=function(R){return function(N){return N<p.filteredrows[R]}};for(C=p.filteredrows.length,t=0;t<C;t++)u=e.filter(O(t)),p.filteredrows[t]-=u.length},V.prototype.mapReduce=function(e,t){try{return t(this.data().map(e))}catch(r){throw r}};function I(e,t){this.name=e,this.data=[],this.idIndex=null,this.binaryIndices={},this.constraints={unique:{},exact:{}},this.uniqueNames=[],this.transforms={},this.objType=e,this.dirty=!0,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null;var r=this;t=t||{},t.hasOwnProperty("unique")&&(Array.isArray(t.unique)||(t.unique=[t.unique]),t.unique.forEach(function(C){r.uniqueNames.push(C)})),t.hasOwnProperty("exact")&&t.exact.forEach(function(C){r.constraints.exact[C]=new Te(C)}),this.adaptiveBinaryIndices=t.hasOwnProperty("adaptiveBinaryIndices")?t.adaptiveBinaryIndices:!0,this.transactional=t.hasOwnProperty("transactional")?t.transactional:!1,this.cloneObjects=t.hasOwnProperty("clone")?t.clone:!1,this.cloneMethod=t.hasOwnProperty("cloneMethod")?t.cloneMethod:"parse-stringify",this.asyncListeners=t.hasOwnProperty("asyncListeners")?t.asyncListeners:!1,this.disableMeta=t.hasOwnProperty("disableMeta")?t.disableMeta:!1,this.disableChangesApi=t.hasOwnProperty("disableChangesApi")?t.disableChangesApi:!0,this.disableDeltaChangesApi=t.hasOwnProperty("disableDeltaChangesApi")?t.disableDeltaChangesApi:!0,this.disableChangesApi&&(this.disableDeltaChangesApi=!0),this.autoupdate=t.hasOwnProperty("autoupdate")?t.autoupdate:!1,this.serializableIndices=t.hasOwnProperty("serializableIndices")?t.serializableIndices:!0,this.disableFreeze=t.hasOwnProperty("disableFreeze")?t.disableFreeze:!0,this.ttl={age:null,ttlInterval:null,daemon:null},this.setTTL(t.ttl||-1,t.ttlInterval),this.maxId=0,this.DynamicViews=[],this.events={insert:[],update:[],"pre-insert":[],"pre-update":[],close:[],flushbuffer:[],error:[],delete:[],warning:[]},this.changes=[],this.dirtyIds=[];var i=[];if(t&&t.indices)if(Object.prototype.toString.call(t.indices)==="[object Array]")i=t.indices;else if(typeof t.indices=="string")i=[t.indices];else throw new TypeError("Indices needs to be a string or an array of strings");for(var n=0;n<i.length;n++)this.ensureIndex(i[n]);function a(C){var O=typeof Set=="function"?new Set:[];O.add||(O.add=function(R){return this.indexOf(R)===-1&&this.push(R),this}),C.forEach(function(R){O.add(R.object)}),O.forEach(function(R){if(!D.call(R,"$loki"))return r.removeAutoUpdateObserver(R);try{r.update(R)}catch{}})}this.observerCallback=a;function u(C,O){return O?p(O,C):JSON.parse(JSON.stringify(C))}this.getChangeDelta=u;function p(C,O){var R=O!==null&&typeof O=="object"?Object.keys(O):null;if(R&&R.length&&["string","boolean","number"].indexOf(typeof O)<0){for(var N={},z=0;z<R.length;z++){var U=R[z];if(O.hasOwnProperty(U))if(!C.hasOwnProperty(U)||r.uniqueNames.indexOf(U)>=0||U=="$loki"||U=="meta")N[U]=O[U];else{var te=p(C[U],O[U]);typeof te<"u"&&te!={}&&(N[U]=te)}}return Object.keys(N).length===0?void 0:N}else return C===O?void 0:O}this.getObjectDelta=p;function g(){r.changes=[]}this.getChanges=function(){return r.changes},this.flushChanges=g,this.setChangesApi=function(C){r.disableChangesApi=!C,C||(r.disableDeltaChangesApi=!1)},this.on("delete",function(O){r.disableChangesApi||r.createChange(r.name,"R",O)}),this.on("warning",function(C){r.lokiConsoleWrapper.warn(C)}),g()}I.prototype=new pe,I.prototype.contructor=I,I.prototype.createChange=function(e,t,r,i){this.changes.push({name:e,operation:t,obj:t=="U"&&!this.disableDeltaChangesApi?this.getChangeDelta(r,i):JSON.parse(JSON.stringify(r))})},I.prototype.insertMeta=function(e){var t,r;if(!(this.disableMeta||!e)){if(Array.isArray(e)){for(t=e.length,r=0;r<t;r++)e[r].hasOwnProperty("meta")||(e[r].meta={}),e[r].meta.created=new Date().getTime(),e[r].meta.revision=0;return}e.meta||(e.meta={}),e.meta.created=new Date().getTime(),e.meta.revision=0}},I.prototype.updateMeta=function(e){return this.disableMeta||!e||(this.disableFreeze||(e=v(e),e.meta=v(e.meta)),e.meta.updated=new Date().getTime(),e.meta.revision+=1),e},I.prototype.createInsertChange=function(e){this.createChange(this.name,"I",e)},I.prototype.createUpdateChange=function(e,t){this.createChange(this.name,"U",e,t)},I.prototype.insertMetaWithChange=function(e){this.insertMeta(e),this.createInsertChange(e)},I.prototype.updateMetaWithChange=function(e,t,r){return e=this.updateMeta(e,r),this.createUpdateChange(e,t),e},I.prototype.lokiConsoleWrapper={log:function(){},warn:function(){},error:function(){}},I.prototype.addAutoUpdateObserver=function(e){!this.autoupdate||typeof Object.observe!="function"||Object.observe(e,this.observerCallback,["add","update","delete","reconfigure","setPrototype"])},I.prototype.removeAutoUpdateObserver=function(e){!this.autoupdate||typeof Object.observe!="function"||Object.unobserve(e,this.observerCallback)},I.prototype.addTransform=function(e,t){if(this.transforms.hasOwnProperty(e))throw new Error("a transform by that name already exists");this.transforms[e]=t},I.prototype.getTransform=function(e){return this.transforms[e]},I.prototype.setTransform=function(e,t){this.transforms[e]=t},I.prototype.removeTransform=function(e){delete this.transforms[e]},I.prototype.byExample=function(e){var t,r,i;i=[];for(t in e)e.hasOwnProperty(t)&&i.push((r={},r[t]=e[t],r));return{$and:i}},I.prototype.findObject=function(e){return this.findOne(this.byExample(e))},I.prototype.findObjects=function(e){return this.find(this.byExample(e))},I.prototype.ttlDaemonFuncGen=function(){var e=this,t=this.ttl.age;return function(){var i=Date.now(),n=e.chain().where(function(u){var p=u.meta.updated||u.meta.created,g=i-p;return t<g});n.remove()}},I.prototype.setTTL=function(e,t){e<0?clearInterval(this.ttl.daemon):(this.ttl.age=e,this.ttl.ttlInterval=t,this.ttl.daemon=setInterval(this.ttlDaemonFuncGen(),t))},I.prototype.prepareFullDocIndex=function(){for(var e=this.data.length,t=new Array(e),r=0;r<e;r+=1)t[r]=r;return t},I.prototype.configureOptions=function(e){e=e||{},e.hasOwnProperty("adaptiveBinaryIndices")&&(this.adaptiveBinaryIndices=e.adaptiveBinaryIndices,this.adaptiveBinaryIndices&&this.ensureAllIndexes())},I.prototype.ensureIndex=function(e,t){if(typeof t>"u"&&(t=!1),e==null)throw new Error("Attempting to set index without an associated property");if(!(this.binaryIndices[e]&&!t&&!this.binaryIndices[e].dirty)&&!(this.adaptiveBinaryIndices===!0&&this.binaryIndices.hasOwnProperty(e)&&!t)){var r={name:e,dirty:!0,values:this.prepareFullDocIndex()};this.binaryIndices[e]=r;var i=function(n,a){var u,p,g=~n.indexOf(".")?n.split("."):!1;return function(C,O){if(g?(u=y.getIn(a[C],g,!0),p=y.getIn(a[O],g,!0)):(u=a[C][n],p=a[O][n]),u!==p){if(w.lt(u,p,!1))return-1;if(w.gt(u,p,!1))return 1}return 0}}(e,this.data);r.values.sort(i),r.dirty=!1,this.dirty=!0}},I.prototype.checkAllIndexes=function(e){var t,r=this.binaryIndices,i=[],n;for(t in r)D.call(r,t)&&(n=this.checkIndex(t,e),n||i.push(t));return i},I.prototype.checkIndex=function(e,t){t=t||{},t.randomSamplingFactor&&t.randomSampling!==!1&&(t.randomSampling=!0),t.randomSamplingFactor=t.randomSamplingFactor||.1,(t.randomSamplingFactor<0||t.randomSamplingFactor>1)&&(t.randomSamplingFactor=.1);var r=!0,i,n,a,u,p;if(!this.binaryIndices.hasOwnProperty(e))throw new Error("called checkIndex on property without an index: "+e);if(this.adaptiveBinaryIndices||this.ensureIndex(e),p=this.binaryIndices[e].values,u=p.length,u!==this.data.length)return t.repair&&this.ensureIndex(e,!0),!1;if(u===0)return!0;var g=e.indexOf(".")!==-1;if(u===1)r=p[0]===0;else if(t.randomSampling){if(W.$lte(y.getIn(this.data[p[0]],e,g),y.getIn(this.data[p[1]],e,g))||(r=!1),W.$lte(y.getIn(this.data[p[u-2]],e,g),y.getIn(this.data[p[u-1]],e,g))||(r=!1),r){for(n=Math.floor((u-1)*t.randomSamplingFactor),i=0;i<n-1;i++)if(a=Math.floor(Math.random()*(u-1)),!W.$lte(y.getIn(this.data[p[a]],e,g),y.getIn(this.data[p[a+1]],e,g))){r=!1;break}}}else for(i=0;i<u-1;i++)if(!W.$lte(y.getIn(this.data[p[i]],e,g),y.getIn(this.data[p[i+1]],e,g))){r=!1;break}return!r&&t.repair&&this.ensureIndex(e,!0),r},I.prototype.getBinaryIndexValues=function(e){var t,r=this.binaryIndices[e].values,i=[];for(t=0;t<r.length;t++)i.push(y.getIn(this.data[r[t]],e,!0));return i},I.prototype.getUniqueIndex=function(e,t){var r=this.constraints.unique[e];return!r&&t?this.ensureUniqueIndex(e):r},I.prototype.ensureUniqueIndex=function(e){var t=this.constraints.unique[e];return t||this.uniqueNames.indexOf(e)==-1&&this.uniqueNames.push(e),this.constraints.unique[e]=t=new be(e),this.data.forEach(function(r){t.set(r)}),t},I.prototype.ensureAllIndexes=function(e){var t,r=this.binaryIndices;for(t in r)D.call(r,t)&&this.ensureIndex(t,e)},I.prototype.flagBinaryIndexesDirty=function(){var e,t=this.binaryIndices;for(e in t)D.call(t,e)&&(t[e].dirty=!0)},I.prototype.flagBinaryIndexDirty=function(e){this.binaryIndices[e]&&(this.binaryIndices[e].dirty=!0)},I.prototype.count=function(e){return e?this.chain().find(e).filteredrows.length:this.data.length},I.prototype.ensureId=function(){if(!this.idIndex){var e=this.data,t=0,r=e.length,i=new Array(r);for(t;t<r;t++)i[t]=e[t].$loki;this.idIndex=i}},I.prototype.ensureIdAsync=function(e){this.async(function(){this.ensureId()},e)},I.prototype.addDynamicView=function(e,t){var r=new V(this,e,t);return this.DynamicViews.push(r),r},I.prototype.removeDynamicView=function(e){this.DynamicViews=this.DynamicViews.filter(function(t){return t.name!==e})},I.prototype.getDynamicView=function(e){for(var t=0;t<this.DynamicViews.length;t++)if(this.DynamicViews[t].name===e)return this.DynamicViews[t];return null},I.prototype.findAndUpdate=function(e,t){typeof e=="function"?this.updateWhere(e,t):this.chain().find(e).update(t)},I.prototype.findAndRemove=function(e){this.chain().find(e).remove()},I.prototype.insert=function(e,t){if(!Array.isArray(e))return this.insertOne(e);var r,i=[],n=t&&!this.cloneObjects&&this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0;n&&(this.adaptiveBinaryIndices=!1);try{this.emit("pre-insert",e);for(var a=0,u=e.length;a<u;a++){if(r=this.insertOne(e[a],!0),!r)return;i.push(r)}}finally{n&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}return this.emit("insert",i),i=this.cloneObjects?K(i,this.cloneMethod):i,i.length===1?i[0]:i},I.prototype.insertOne=function(e,t){var r=null,i;if(typeof e!="object"?r=new TypeError("Document needs to be an object"):e===null&&(r=new TypeError("Object cannot be null")),r!==null)throw this.emit("error",r),r;var n=this.cloneObjects?K(e,this.cloneMethod):e;if(this.disableFreeze||(n=v(n)),this.disableMeta||(typeof n.meta>"u"?n.meta={revision:0,created:0}:this.disableFreeze||(n.meta=v(n.meta))),t||this.emit("pre-insert",n),!!this.add(n))return this.disableChangesApi?this.insertMeta(n):this.insertMetaWithChange(n),this.disableFreeze||m(n),i=this.cloneObjects?K(n,this.cloneMethod):n,t||this.emit("insert",i),this.addAutoUpdateObserver(i),i},I.prototype.clear=function(e){var t=this;if(e=e||{},this.data=[],this.idIndex=null,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null,this.maxId=0,this.DynamicViews=[],this.dirty=!0,this.constraints={unique:{},exact:{}},e.removeIndices===!0)this.binaryIndices={},this.uniqueNames=[];else{var r=Object.keys(this.binaryIndices);r.forEach(function(i){t.binaryIndices[i].dirty=!1,t.binaryIndices[i].values=[]})}},I.prototype.update=function(e){var t,r,i;if(Array.isArray(e)){i=e.length,t=!this.cloneObjects&&this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0,t&&(this.adaptiveBinaryIndices=!1);try{for(r=0;r<i;r+=1)this.update(e[r])}finally{t&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}return}if(!D.call(e,"$loki"))throw new Error("Trying to update unsynced document. Please save the document first by using insert() or addMany()");try{this.startTransaction();var n=this.get(e.$loki,!0),a,u,p,g=this;if(!n)throw new Error("Trying to update a document not in collection.");a=n[0],p=n[1],u=this.cloneObjects||!this.disableDeltaChangesApi&&this.disableFreeze?K(e,this.cloneMethod):e,this.emit("pre-update",e),this.uniqueNames.forEach(function(z){g.getUniqueIndex(z,!0).update(a,u)}),this.data[p]=u,u!==e&&this.addAutoUpdateObserver(e);for(var C=0;C<this.DynamicViews.length;C++)this.DynamicViews[C].evaluateDocument(p,!1);var O;if(this.adaptiveBinaryIndices){var R=this.binaryIndices;for(O in R)this.adaptiveBinaryIndexUpdate(p,O)}else this.flagBinaryIndexesDirty();this.idIndex[p]=u.$loki,this.isIncremental&&this.dirtyIds.push(u.$loki),this.commit(),this.dirty=!0,this.disableChangesApi?u=this.updateMeta(u):u=this.updateMetaWithChange(u,a),this.disableFreeze||m(u);var N;return this.cloneObjects?N=K(u,this.cloneMethod):N=u,this.emit("update",N,a),N}catch(z){throw this.rollback(),this.lokiConsoleWrapper.error(z.message),this.emit("error",z),z}},I.prototype.add=function(e){if(typeof e!="object")throw new TypeError("Object being added needs to be an object");if(typeof e.$loki<"u")throw new Error("Document is already in collection, please use update()");try{this.startTransaction(),this.maxId++,isNaN(this.maxId)&&(this.maxId=this.data[this.data.length-1].$loki+1);var t=this.maxId;e.$loki=t,this.disableMeta||(e.meta.version=0);for(var r=0,i=this.uniqueNames.length;r<i;r++)this.getUniqueIndex(this.uniqueNames[r],!0).set(e);this.idIndex&&this.idIndex.push(t),this.isIncremental&&this.dirtyIds.push(t),this.data.push(e);var n=this.data.length-1,a=this.DynamicViews.length;for(r=0;r<a;r++)this.DynamicViews[r].evaluateDocument(n,!0);if(this.adaptiveBinaryIndices){var u=this.binaryIndices;for(var p in u)this.adaptiveBinaryIndexInsert(n,p)}else this.flagBinaryIndexesDirty();return this.commit(),this.dirty=!0,this.cloneObjects?K(e,this.cloneMethod):e}catch(g){throw this.rollback(),this.lokiConsoleWrapper.error(g.message),this.emit("error",g),g}},I.prototype.updateWhere=function(e,t){var r=this.where(e),i=0,n;try{for(i;i<r.length;i++)n=t(r[i]),this.update(n)}catch(a){this.rollback(),this.lokiConsoleWrapper.error(a.message)}},I.prototype.removeWhere=function(e){var t;typeof e=="function"?(t=this.data.filter(e),this.remove(t)):this.chain().find(e).remove()},I.prototype.removeDataOnly=function(){this.remove(this.data.slice())},I.prototype.removeBatchByPositions=function(e){var t=e.length,r={},i,n,a,u=Object.keys(this.binaryIndices).length,p=Object.keys(this.constraints.unique).length,g=this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0,C,O=this;try{for(this.startTransaction(),this.ensureId(),a=0;a<t;a++)r[this.idIndex[e[a]]]=!0;if(i=this.DynamicViews.length,i>0||u>0||p>0){if(i>0)for(n=0;n<i;n++)this.DynamicViews[n].removeDocument(e);if(this.adaptiveBinaryIndices&&!g){var R,N=this.binaryIndices;for(R in N)this.adaptiveBinaryIndexRemove(e,R)}else this.flagBinaryIndexesDirty();p&&this.uniqueNames.forEach(function(z){var U=O.getUniqueIndex(z);if(U)for(a=0;a<t;a++)C=O.data[e[a]],C[z]!==null&&C[z]!==void 0&&U.remove(C[z])})}if(!this.disableChangesApi||this.events.delete.length>1)for(a=0;a<t;a++)this.emit("delete",this.data[e[a]]);if(this.data=this.data.filter(function(z){return!r[z.$loki]}),this.isIncremental)for(a=0;a<t;a++)this.dirtyIds.push(this.idIndex[e[a]]);this.idIndex=this.idIndex.filter(function(z){return!r[z]}),this.adaptiveBinaryIndices&&g&&(this.adaptiveBinaryIndices=!1,this.ensureAllIndexes(!0),this.adaptiveBinaryIndices=!0),this.commit(),this.dirty=!0}catch(z){return this.rollback(),g&&(this.adaptiveBinaryIndices=!0),this.lokiConsoleWrapper.error(z.message),this.emit("error",z),null}},I.prototype.removeBatch=function(e){var t=e.length,r=this.data.length,i,n={},a=[];for(i=0;i<r;i++)n[this.data[i].$loki]=i;for(i=0;i<t;i++)typeof e[i]=="object"?a.push(n[e[i].$loki]):a.push(n[e[i]]);this.removeBatchByPositions(a)},I.prototype.remove=function(e){var t;if(typeof e=="number"&&(e=this.get(e)),typeof e!="object")throw new Error("Parameter is not an object");if(Array.isArray(e)){this.removeBatch(e);return}if(!D.call(e,"$loki"))throw new Error("Object is not a document stored in the collection");try{this.startTransaction();var r=this.get(e.$loki,!0),i=r[1],n=this;this.uniqueNames.forEach(function(g){if(e[g]!==null&&typeof e[g]<"u"){var C=n.getUniqueIndex(g);C&&C.remove(e[g])}});for(var a=0;a<this.DynamicViews.length;a++)this.DynamicViews[a].removeDocument(i);if(this.adaptiveBinaryIndices){var u,p=this.binaryIndices;for(u in p)this.adaptiveBinaryIndexRemove(i,u)}else this.flagBinaryIndexesDirty();return this.data.splice(i,1),this.removeAutoUpdateObserver(e),this.idIndex.splice(i,1),this.isIncremental&&this.dirtyIds.push(e.$loki),this.commit(),this.dirty=!0,this.emit("delete",r[0]),this.disableFreeze||(e=v(e)),delete e.$loki,delete e.meta,this.disableFreeze||c(e),e}catch(g){return this.rollback(),this.lokiConsoleWrapper.error(g.message),this.emit("error",g),null}},I.prototype.get=function(e,t){this.idIndex||this.ensureId();var r=t||!1,i=this.idIndex,n=i.length-1,a=0,u=a+n>>1;if(e=typeof e=="number"?e:parseInt(e,10),isNaN(e))throw new TypeError("Passed id is not an integer");for(;i[a]<i[n];)u=a+n>>1,i[u]<e?a=u+1:n=u;return n===a&&i[a]===e?r?[this.data[a],a]:this.data[a]:null},I.prototype.getBinaryIndexPosition=function(e,t){var r=y.getIn(this.data[e],t,!0),i=this.binaryIndices[t].values,n=this.calculateRange("$eq",t,r);if(n[0]===0&&n[1]===-1)return null;for(var a=n[0],u=n[1],p=a;p<=u;p++)if(i[p]===e)return p;return null},I.prototype.adaptiveBinaryIndexInsert=function(e,t){var r=t.indexOf(".")!==-1,i=this.binaryIndices[t].values,n=y.getIn(this.data[e],t,r);this.serializableIndices===!0&&n instanceof Date&&(this.data[e][t]=n.getTime(),n=y.getIn(this.data[e],t));var a=i.length===0?0:this.calculateRangeStart(t,n,!0,r);this.binaryIndices[t].values.splice(a,0,e)},I.prototype.adaptiveBinaryIndexUpdate=function(e,t){var r,i=this.binaryIndices[t].values,n=i.length;for(r=0;r<n&&i[r]!==e;r++);this.binaryIndices[t].values.splice(r,1),this.adaptiveBinaryIndexInsert(e,t)},I.prototype.adaptiveBinaryIndexRemove=function(e,t,r){var i=this.binaryIndices[t],n,a,u,p,g={},C,O,R;if(Array.isArray(e))if(p=e.length,p===1)e=e[0];else{for(u=0;u<p;u++)g[e[u]]=!0;if(i.values=i.values.filter(function(z){return!g[z]}),r===!0)return;var N=e.slice();for(N.sort(function(z,U){return z-U}),n=i.values.length,a=0;a<n;a++){for(C=i.values[a],O=0,u=0;u<p&&C>N[u];u++)O++;i.values[a]-=O}return}if(R=this.getBinaryIndexPosition(e,t),R===null)return null;if(i.values.splice(R,1),r!==!0)for(n=i.values.length,a=0;a<n;a++)i.values[a]>e&&i.values[a]--},I.prototype.calculateRangeStart=function(e,t,r,i){var n=this.data,a=this.binaryIndices[e].values,u=0,p=a.length-1,g=0;if(a.length===0)return-1;for(var C=y.getIn(n[a[u]],e,i),O=y.getIn(n[a[p]],e,i);u<p;)g=u+p>>1,w.lt(y.getIn(n[a[g]],e,i),t,!1)?u=g+1:p=g;var R=u;return w.aeq(t,y.getIn(n[a[R]],e,i))?R:w.lt(t,y.getIn(n[a[R]],e,i),!1)?r?R:R-1:r?R+1:R},I.prototype.calculateRangeEnd=function(e,t,r){var i=this.data,n=this.binaryIndices[e].values,a=0,u=n.length-1,p=0;if(n.length===0)return-1;for(var g=y.getIn(i[n[a]],e,r),C=y.getIn(i[n[u]],e,r);a<u;)p=a+u>>1,w.lt(t,y.getIn(i[n[p]],e,r),!1)?u=p:a=p+1;var O=u;return w.aeq(t,y.getIn(i[n[O]],e,r))?O:w.gt(t,y.getIn(i[n[O]],e,r),!1)?O+1:w.aeq(t,y.getIn(i[n[O-1]],e,r))?O-1:O},I.prototype.calculateRange=function(e,t,r){var i=this.data,n=this.binaryIndices[t].values,a=0,u=n.length-1,p=0,g,C,O,R;if(i.length===0)return[0,-1];var N=t.indexOf(".")!==-1,z=y.getIn(i[n[a]],t,N),U=y.getIn(i[n[u]],t,N);switch(e){case"$eq":case"$aeq":if(w.lt(r,z,!1)||w.gt(r,U,!1))return[0,-1];break;case"$dteq":if(w.lt(r,z,!1)||w.gt(r,U,!1))return[0,-1];break;case"$gt":if(w.gt(r,U,!0))return[0,-1];if(w.gt(z,r,!1))return[a,u];break;case"$gte":if(w.gt(r,U,!1))return[0,-1];if(w.gt(z,r,!0))return[a,u];break;case"$lt":if(w.lt(r,z,!0))return[0,-1];if(w.lt(U,r,!1))return[a,u];break;case"$lte":if(w.lt(r,z,!1))return[0,-1];if(w.lt(U,r,!0))return[a,u];break;case"$between":return w.gt(r[0],U,!1)?[0,-1]:w.lt(r[1],z,!1)?[0,-1]:(g=this.calculateRangeStart(t,r[0],!1,N),O=this.calculateRangeEnd(t,r[1],N),g<0&&g++,O>u&&O--,w.gt(y.getIn(i[n[g]],t,N),r[0],!0)||g++,w.lt(y.getIn(i[n[O]],t,N),r[1],!0)||O--,O<g?[0,-1]:[g,O]);case"$in":for(var te=[],oe=[],ne=0,J=r.length;ne<J;ne++)for(var fe=this.calculateRange("$eq",t,r[ne]),ye=fe[0];ye<=fe[1];ye++)te[ye]===void 0&&(te[ye]=!0,oe.push(ye));return oe}switch(e){case"$eq":case"$aeq":case"$dteq":case"$gte":case"$lt":g=this.calculateRangeStart(t,r,!1,N),C=y.getIn(i[n[g]],t,N);break;default:break}switch(e){case"$eq":case"$aeq":case"$dteq":case"$lte":case"$gt":O=this.calculateRangeEnd(t,r,N),R=y.getIn(i[n[O]],t,N);break;default:break}switch(e){case"$eq":case"$aeq":case"$dteq":return w.aeq(C,r)?[g,O]:[0,-1];case"$gt":return w.aeq(y.getIn(i[n[O]],t,N),r)?[O+1,u]:[O,u];case"$gte":return w.aeq(y.getIn(i[n[g]],t,N),r)?[g,u]:[g+1,u];case"$lt":return w.aeq(y.getIn(i[n[g]],t,N),r)?[a,g-1]:[a,g];case"$lte":return w.aeq(y.getIn(i[n[O]],t,N),r)?[a,O]:[a,O-1];default:return[0,i.length-1]}},I.prototype.by=function(e,t){var r;if(t===void 0)return r=this,function(n){return r.by(e,n)};var i=this.getUniqueIndex(e,!0).get(t);return this.cloneObjects?K(i,this.cloneMethod):i},I.prototype.findOne=function(e){e=e||{};var t=this.chain().find(e,!0).data();return Array.isArray(t)&&t.length===0?null:this.cloneObjects?K(t[0],this.cloneMethod):t[0]},I.prototype.chain=function(e,t){var r=new B(this);return typeof e>"u"?r:r.transform(e,t)},I.prototype.find=function(e){return this.chain().find(e).data()},I.prototype.findOneUnindexed=function(e,t){for(var r=this.data.length,i;r--;)if(y.getIn(this.data[r],e,!0)===t)return i=this.data[r],i;return null},I.prototype.startTransaction=function(){if(this.transactional){this.cachedData=K(this.data,this.cloneMethod),this.cachedIndex=this.idIndex,this.cachedBinaryIndex=this.binaryIndices,this.cachedDirtyIds=this.dirtyIds;for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].startTransaction()}},I.prototype.commit=function(){if(this.transactional){this.cachedData=null,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedDirtyIds=null;for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].commit()}},I.prototype.rollback=function(){if(this.transactional){this.cachedData!==null&&this.cachedIndex!==null&&(this.data=this.cachedData,this.idIndex=this.cachedIndex,this.binaryIndices=this.cachedBinaryIndex,this.dirtyIds=this.cachedDirtyIds);for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].rollback()}},I.prototype.async=function(e,t){setTimeout(function(){if(typeof e=="function")e(),t();else throw new TypeError("Argument passed for async execution is not a function")},0)},I.prototype.where=function(e){return this.chain().where(e).data()},I.prototype.mapReduce=function(e,t){try{return t(this.data.map(e))}catch(r){throw r}},I.prototype.eqJoin=function(e,t,r,i,n){return new B(this).eqJoin(e,t,r,i,n)},I.prototype.stages={},I.prototype.getStage=function(e){return this.stages[e]||(this.stages[e]={}),this.stages[e]},I.prototype.commitLog=[],I.prototype.stage=function(e,t){var r=JSON.parse(JSON.stringify(t));return this.getStage(e)[t.$loki]=r,r},I.prototype.commitStage=function(e,t){var r=this.getStage(e),i,n=new Date().getTime();for(i in r)this.update(r[i]),this.commitLog.push({timestamp:n,message:t,data:JSON.parse(JSON.stringify(r[i]))});this.stages[e]={}},I.prototype.no_op=function(){},I.prototype.extract=function(e){var t=0,r=this.data.length,i=ve(e),n=[];for(t;t<r;t+=1)n.push(ue(this.data[t],e,i));return n},I.prototype.max=function(e){return Math.max.apply(null,this.extract(e))},I.prototype.min=function(e){return Math.min.apply(null,this.extract(e))},I.prototype.maxRecord=function(e){var t=0,r=this.data.length,i=ve(e),n={index:0,value:void 0},a;for(t;t<r;t+=1)a!==void 0?a<ue(this.data[t],e,i)&&(a=ue(this.data[t],e,i),n.index=this.data[t].$loki):(a=ue(this.data[t],e,i),n.index=this.data[t].$loki);return n.value=a,n},I.prototype.minRecord=function(e){var t=0,r=this.data.length,i=ve(e),n={index:0,value:void 0},a;for(t;t<r;t+=1)a!==void 0?a>ue(this.data[t],e,i)&&(a=ue(this.data[t],e,i),n.index=this.data[t].$loki):(a=ue(this.data[t],e,i),n.index=this.data[t].$loki);return n.value=a,n},I.prototype.extractNumerical=function(e){return this.extract(e).map(xe).filter(Number).filter(function(t){return!isNaN(t)})},I.prototype.avg=function(e){return Ne(this.extractNumerical(e))},I.prototype.stdDev=function(e){return je(this.extractNumerical(e))},I.prototype.mode=function(e){var t={},r=this.extract(e);r.forEach(function(u){t[u]?t[u]+=1:t[u]=1});var i,n,a;for(n in t)i?i<t[n]&&(a=n):(a=n,i=t[n]);return a},I.prototype.median=function(e){var t=this.extractNumerical(e);t.sort(Ie);var r=Math.floor(t.length/2);return t.length%2?t[r]:(t[r-1]+t[r])/2};function ve(e){return e.indexOf(".")!==-1}function xe(e){return parseFloat(e,10)}function ke(e){return e!==void 0}function Re(e,t){return e+t}function Ie(e,t){return e-t}function Ve(e){e.sort(Ie);var t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2}function Ne(e){return e.reduce(Re,0)/e.length}function je(e){var t=Ne(e),r=e.map(function(a){var u=a-t,p=u*u;return p}),i=Ne(r),n=Math.sqrt(i);return n}function ue(e,t,r){if(r===!1)return e[t];for(var i=t.split("."),n=e;i.length>0;)n=n[i.shift()];return n}function we(e,t,r){for(var i=0,n=e.length,a,u;i<n;){if(u=i+n>>1,a=r.apply(null,[t,e[u]]),a===0)return{found:!0,index:u};a<0?n=u:i=u+1}return{found:!1,index:n}}function _e(e){return function(t,r){return we(t,r,e)}}function Le(){}Le.prototype={keys:[],values:[],sort:function(e,t){return e<t?-1:e>t?1:0},setSort:function(e){this.bs=new _e(e)},bs:function(){return new _e(this.sort)},set:function(e,t){var r=this.bs(this.keys,e);r.found?this.values[r.index]=t:(this.keys.splice(r.index,0,e),this.values.splice(r.index,0,t))},get:function(e){return this.values[we(this.keys,e,this.sort).index]}};function be(e){this.field=e,this.keyMap=Object.create(null),this.lokiMap=Object.create(null)}be.prototype.keyMap={},be.prototype.lokiMap={},be.prototype.set=function(e){var t=e[this.field];if(t!==null&&typeof t<"u"){if(this.keyMap[t])throw new Error("Duplicate key for property "+this.field+": "+t);this.keyMap[t]=e,this.lokiMap[e.$loki]=t}},be.prototype.get=function(e){return this.keyMap[e]},be.prototype.byId=function(e){return this.keyMap[this.lokiMap[e]]},be.prototype.update=function(e,t){if(this.lokiMap[e.$loki]!==t[this.field]){var r=this.lokiMap[e.$loki];this.set(t),this.keyMap[r]=void 0}else this.keyMap[e[this.field]]=t},be.prototype.remove=function(e){var t=this.keyMap[e];if(t!==null&&typeof t<"u")this.keyMap[e]=void 0,this.lokiMap[t.$loki]=void 0;else throw new Error("Key is not in unique index: "+this.field)},be.prototype.clear=function(){this.keyMap=Object.create(null),this.lokiMap=Object.create(null)};function Te(e){this.index=Object.create(null),this.field=e}Te.prototype={set:function(t,r){this.index[t]?this.index[t].push(r):this.index[t]=[r]},remove:function(t,r){var i=this.index[t];for(var n in i)i[n]==r&&i.splice(n,1);i.length<1&&(this.index[t]=void 0)},get:function(t){return this.index[t]},clear:function(t){this.index={}}};function Ue(e){this.field=e}return Ue.prototype={keys:[],values:[],sort:function(e,t){return e<t?-1:e>t?1:0},bs:function(){return new _e(this.sort)},setSort:function(e){this.bs=new _e(e)},set:function(e,t){var r=we(this.keys,e,this.sort);r.found?this.values[r.index].push(t):(this.keys.splice(r.index,0,e),this.values.splice(r.index,0,[t]))},get:function(e){var t=we(this.keys,e,this.sort);return t.found?this.values[t.index]:[]},getLt:function(e){var t=we(this.keys,e,this.sort),r=t.index;return t.found&&r--,this.getAll(e,0,r)},getGt:function(e){var t=we(this.keys,e,this.sort),r=t.index;return t.found&&r++,this.getAll(e,r,this.keys.length)},getAll:function(e,t,r){for(var i=[],n=t;n<r;n++)i=i.concat(this.values[n]);return i},getPos:function(e){return we(this.keys,e,this.sort)},remove:function(e,t){var r=we(this.keys,e,this.sort).index,i=this.values[r];for(var n in i)i[n]==t&&i.splice(n,1);i.length<1&&(this.keys.splice(r,1),this.values.splice(r,1))},clear:function(){this.keys=[],this.values=[]}},F.deepFreeze=m,F.freeze=c,F.unFreeze=v,F.LokiOps=W,F.Collection=I,F.DynamicView=V,F.Resultset=B,F.KeyValueStore=Le,F.LokiMemoryAdapter=k,F.LokiPartitioningAdapter=H,F.LokiLocalStorageAdapter=X,F.LokiFsAdapter=j,F.persistenceAdapters={fs:j,localStorage:X},F.aeq=E,F.lt=$,F.gt=T,F.Comparators=w,F}()})});var Oe=Xe(St(),1);var rt=function(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;this._parallels=m||1,this._qC=0,this._iC=new Set,this._lHN=0,this._hPM=new Map,this._pHM=new Map};rt.prototype={isIdle:function(){return this._qC<this._parallels},lock:function(){this._qC++},unlock:function(){this._qC--,tt(this)},wrapCall:function(m){var c=this;this.lock();var v;try{v=m()}catch(y){throw this.unlock(),y}return!v.then||typeof v.then!="function"?(this.unlock(),v):v.then(function(y){return c.unlock(),y}).catch(function(y){throw c.unlock(),y})},requestIdlePromise:function(m){var c=this;m=m||{};var v,y=new Promise(function($){return v=$}),w=function(){et(c,y),v()};if(y._manRes=w,m.timeout){var E=setTimeout(function(){y._manRes()},m.timeout);y._timeoutObj=E}return this._iC.add(y),tt(this),y},cancelIdlePromise:function(m){et(this,m)},requestIdleCallback:function(m,c){var v=this._lHN++,y=this.requestIdlePromise(c);return this._hPM.set(v,y),this._pHM.set(y,v),y.then(function(){return m()}),v},cancelIdleCallback:function(m){var c=this._hPM.get(m);this.cancelIdlePromise(c)},clear:function(){var m=this;this._iC.forEach(function(c){return et(m,c)}),this._qC=0,this._iC.clear(),this._hPM=new Map,this._pHM=new Map}};function hr(D){if(D._iC.size!==0){var m=D._iC.values(),c=m.next().value;c._manRes(),setTimeout(function(){return tt(D)},0)}}function et(D,m){if(m){if(m._timeoutObj&&clearTimeout(m._timeoutObj),D._pHM.has(m)){var c=D._pHM.get(m);D._hPM.delete(c),D._pHM.delete(m)}D._iC.delete(m)}}function tt(D){D._tryIR||D._iC.size===0||(D._tryIR=!0,setTimeout(function(){if(!D.isIdle()){D._tryIR=!1;return}setTimeout(function(){if(!D.isIdle()){D._tryIR=!1;return}hr(D),D._tryIR=!1},0)},0))}var xt=Xe(Ot(),1),At=Xe(nt(),1);var Pe="key",at=class{collection;db;driver;constructor(){let m=this;this.driver={_driver:"lokijs",_initStorage:function(c){return m.initStorage(c)},clear:function(){return m.clear(this)},getItem:function(c){return m.getItem(this,c)},iterate:function(c){return m.iterate(this,c)},key:function(c){return m.key(this,c)},keys:function(){return m.keys(this)},length:function(){return m.length(this)},removeItem:function(c){return m.removeItem(this,c)},setItem:function(c,v){return m.setItem(this,c,v)}}}clear(m){return new Promise(c=>{m.ready().then(()=>{this.hasCollectionAndDataInCollection()&&this.clearCollection(),c(null)})})}getItem(m,c){return new Promise(v=>{m.ready().then(()=>{if(this.hasCollectionAndDataInCollection()){let y=this.getItemInCollectionBy(Pe,c);y&&v(y.value)}v(null)})})}initStorage(m){return new Promise(c=>{try{this.configureLokiStorage(m,this.databaseInitialize.bind(this,m,c))}catch{throw new Error("Cannot configure Loki Storage")}})}iterate(m,c){return new Promise(v=>{m.ready().then(()=>{this.hasCollectionAndDataInCollection()&&this.iterateWithDataItem(c),v(null)})})}key(m,c){return new Promise(v=>{m.ready().then(()=>{if(this.hasCollection()){let y=this.getLokiMap();v(y[c])}v(null)})})}keys(m){return new Promise(c=>{m.ready().then(()=>{if(this.hasCollection()){let v=[],y=this.getLokiMap();for(let w of Object.keys(y))v.push(y[w]);c(v)}c(null)})})}length(m){return new Promise(c=>{m.ready().then(()=>{this.hasCollection()&&c(this.getNumberItensInCollection()),c(0)})})}removeItem(m,c){return new Promise(v=>{m.ready().then(()=>{this.hasCollection()&&this.findAndRemoveItem(c),v(null)})})}setItem(m,c,v){return new Promise(y=>{m.ready().then(()=>{if(this.hasCollection()){let w;this.hasDataInCollection()&&(w=this.getItemInCollectionBy(Pe,c)),this.insertOrUpdate(w,v,c)}y(v)})})}getDriver(){return this.driver}addCollection(m){return this.db.addCollection(m.storeName,{unique:[Pe]})}clearCollection(){this.collection.clear({removeIndices:!1})}configureLokiStorage(m,c){let v=new At.default;this.db=new xt.default(m.name,{adapter:v,autoload:!0,autoloadCallback:c,autosave:!0,autosaveInterval:4e3})}findAndRemoveItem(m){this.collection.findAndRemove({[Pe]:m})}getCollection(m){return this.db.getCollection(m.storeName)}databaseInitialize(m,c){this.collection=this.getCollection(m),this.hasCollection()||(this.collection=this.addCollection(m)),c()}getItemInCollectionBy(m,c){return this.collection.by(m,c)}getLokiMap(){return this.collection.constraints.unique[Pe].lokiMap}hasCollection(){return this.collection}hasDataInCollection(){return this.collection.data&&this.collection.data.length}hasCollectionAndDataInCollection(){return this.hasCollection()&&this.hasDataInCollection()}insertOrUpdate(m,c,v){m?(m.value=c,this.collection.update(m)):this.collection.insert({[Pe]:v,value:c})}iterateWithDataItem(m){this.collection.data.forEach(c=>{m(c.value,c[Pe],c.$loki)})}getNumberItensInCollection(){return this.collection.count()}},ot=new gt("PO_STORAGE_CONFIG_TOKEN"),Me=(()=>{class D{driver=null;idleQueue=new rt;storagePromise;lokijsDriver;constructor(c){this.lokijsDriver=new at,this.setStoragePromise(c)}static getDefaultConfig(){return{name:"_postorage",storeName:"_pokv",driverOrder:["websql","indexeddb","localstorage","lokijs"]}}static providePoStorage(c){return new D(D.getConfig(c))}static getConfig(c){return c||D.getDefaultConfig()}appendArrayToArray(c,v){return le(this,null,function*(){let w=[...yield this.getArrayOfStorage(c),...v];return this.set(c,w)})}appendItemToArray(c,v){return le(this,null,function*(){let y=yield this.getArrayOfStorage(c);return y.push(v),this.set(c,y)})}clear(){return this.storagePromise.then(c=>c.clear())}exists(c){return this.get(c).then(v=>Promise.resolve(v!==null))}forEach(c){return this.storagePromise.then(v=>v.iterate(c))}get(c,v=!1){return le(this,null,function*(){return v?(yield this.requestIdlePromise(),yield this.idleQueue.wrapCall(()=>le(this,null,function*(){yield this.getImmutableItem(c)}))):yield this.getImmutableItem(c)})}getDriver(){return this.driver}getFirstItem(c){return this.get(c).then(v=>Promise.resolve(v?v[0]:null))}getItemAndRemove(c){return this.get(c).then(v=>{if(v===null)return null;let y=v.shift();return this.set(c,v).then(()=>Promise.resolve(y))})}getItemByField(c,v,y){return this.get(c).then(w=>{let E=w.find($=>$[v]===y);return E=E||null,Promise.resolve(E)})}keys(){return this.storagePromise.then(c=>c.keys())}length(){return this.storagePromise.then(c=>c.length())}limitedCallWrap(c){return le(this,null,function*(){return yield this.requestIdlePromise(),this.idleQueue.wrapCall(c)})}lock(){this.idleQueue.lock()}ready(){return this.storagePromise}remove(c){return this.storagePromise.then(v=>v.removeItem(c))}removeIndexFromObject(c,v){return le(this,null,function*(){let y=yield this.getObjectOfStorage(c);return delete y[v],this.set(c,y)})}removeItemFromArray(c,v,y){return le(this,null,function*(){let w=yield this.getArrayOfStorage(c);return w=w.filter(E=>E[v]!==y),this.set(c,w)})}requestIdlePromise(){return this.idleQueue.requestIdlePromise()}set(c,v,y=!1){return le(this,null,function*(){let w=yield this.storagePromise,E=typeof v=="object"?JSON.parse(JSON.stringify(v)):v;return y?(yield this.requestIdlePromise(),this.idleQueue.wrapCall(()=>w.setItem(c,E))):w.setItem(c,E)})}setIndexToObject(c,v,y){return le(this,null,function*(){let w=yield this.getObjectOfStorage(c);return w[v]=y,this.set(c,w)})}unlock(){this.idleQueue.unlock()}getArrayOfStorage(c){return le(this,null,function*(){return(yield this.get(c))||[]})}getImmutableItem(c){return le(this,null,function*(){let y=yield(yield this.storagePromise).getItem(c);return y?JSON.parse(JSON.stringify(y)):null})}defineLocalForageDriver(c,v){return le(this,null,function*(){return yield c.defineDriver(this.lokijsDriver.getDriver()),yield this.setDriver(c,v),c})}getDriverOrder(c){return c.map(v=>{switch(v){case"indexeddb":return Oe.INDEXEDDB;case"websql":return Oe.WEBSQL;case"localstorage":return Oe.LOCALSTORAGE;default:return v}})}getObjectOfStorage(c){return le(this,null,function*(){return(yield this.get(c))||{}})}setDriver(c,v){return le(this,null,function*(){yield c.setDriver(this.getDriverOrder(v)),this.driver=c.driver()})}setStoragePromise(c){this.storagePromise=this.getStorageInstance(c)}getStorageInstance(c){return le(this,null,function*(){let v=D.getDefaultConfig(),y=Object.assign(v,c||{}),w=Oe.createInstance(y);try{return yield this.defineLocalForageDriver(w,y.driverOrder)}catch{throw new Error(`Cannot use this drivers: ${y.driverOrder.join(", ")}.`)}})}static \u0275fac=function(v){return new(v||D)($e(ot))};static \u0275prov=qe({token:D,factory:D.\u0275fac,providedIn:"root"})}return D})(),Or=(()=>{class D{static forRoot(c){return{ngModule:D,providers:[{provide:ot,useValue:c||Me.getDefaultConfig()},{provide:Me,useFactory:Me.providePoStorage,deps:[ot]}]}}static \u0275fac=function(v){return new(v||D)};static \u0275mod=mt({type:D});static \u0275inj=yt({})}return D})();var vr=new bt,_r=(()=>{class D{constructor(c,v){this.http=c,this.storage=v,this.path="auth",this.ApiRest=vr.URL+"/cardallapis/login?"}getLogin(c,v){return this.http.get(this.ApiRest+"user="+c+"&password="+v)}isLoggedIn(){return le(this,null,function*(){return this.storage.get("loggedIn").then(c=>c)})}static{this.\u0275fac=function(v){return new(v||D)($e(wt),$e(Me))}}static{this.\u0275prov=qe({token:D,factory:D.\u0275fac,providedIn:"root"})}}return D})();export{Me as a,Or as b,_r as c};
