<po-page-default [p-breadcrumb]="breadcrumb">
    <p class="po-mb-4 po-ml-1">Cadastro para definição de estrutra padrão de orçamentos.</p>
    <div class="po-row">
      <po-stepper #stepper [p-sequential]="true">
        <po-step p-label="Definição" class="tsc-center">
          <!-- [p-can-active-next-step]="isConfirmedEstrutura.bind(this)" -->
          <po-widget
            [p-height]="580"
            class="po-md-8"
            p-primary-label="Próximo passo"
            p-title="Identifique a estrutura"
            (p-primary-action)="stepper.next()">
            <form #definicaoForm="ngForm">
              <div class="po-row">
                <po-switch 
                  class="po-md-12"
                  name="switch" 
                  p-label="Estrutura" 
                  [(ngModel)]="tipoEstrutura"
                  p-label-off="Especial"
                  p-label-on="Padrão">
                </po-switch>
                <po-select
                  class="po-md-3"
                  name="tipoEstrutura"
                  (p-change)="onChangeTipoEstrutura($event)"
                  p-disabled="false"
                  p-label="Equipamento"
                  [p-options]="tipoEquipamento"
                  p-required="true"
                  p-optional="false"
                  p-placeholder=""
                  p-readonly="false"
                  p-auto-focus="false">
                </po-select>
                <po-input
                  class="po-md-2"
                  name="codigoEstrutura"
                  [(ngModel)]="codigoEstrutura"
                  p-label="Código"
                  [p-optional]="false"
                  p-placeholder=""
                  p-required="true"
                  p-readonly="true"
                  p-auto-focus="true">
                </po-input>
                <po-input
                  class="po-md-6"
                  name="descricao"
                  [(ngModel)]="nomeEstrutura"
                  p-label="Descrição"
                  [p-optional]="false"
                  p-placeholder=""
                  p-required="true"
                  p-readonly="false"
                  p-auto-focus="true">
                </po-input>
                <po-input
                  class="po-md-3"
                  name="areaInterna"
                  [(ngModel)]="areaInterna"
                  p-label="Área Interna"
                  [p-optional]="false"
                  p-placeholder=""
                  p-required="true"
                  p-readonly="false"
                  p-auto-focus="true">
                </po-input>
                <po-input
                  class="po-md-3"
                  name="areaExterna"
                  [(ngModel)]="areaExterna"
                  p-label="Área Externa"
                  [p-optional]="false"
                  p-placeholder=""
                  p-required="true"
                  p-readonly="false"
                  p-auto-focus="true">
                </po-input>
                <po-switch 
                  class="po-md-12"
                  name="switch" 
                  p-label="Status" 
                  [(ngModel)]="statusEstrutura"
                  p-label-off="Bloqueada"
                  p-label-on="Disponível">
                </po-switch>
              </div>
            </form>
          </po-widget>
        </po-step>
        <po-step p-label="Estrutura">
          <p class="po-font-subtitle">Faça a criação da estrutura</p>
          <div class="po-lg-4">
            <!-- <po-button class="po-md-3" p-icon="ICON_CART" p-label="Add items to cart" (p-click)="addToCart()"> </po-button> -->
            <div class="po-table-actions">
              <po-button 
                p-icon="ph ph-plus"
                p-label="Estrutura"
                p-small="false"
                p-type="default"
                (p-click)="adicionarEstrutura()">
              </po-button>
            </div>
            <po-accordion
              #accordion 
              [p-show-manager-accordion]="true">
              <po-accordion-item 
                *ngFor="let estrutura of estruturas; let i = index" 
                p-label="Estrutura {{ i+1 }}">
                <po-select
                  class="po-md-6"
                  name="produto"
                  (p-change)="onChangeProduto($event,i)"
                  p-disabled="false"
                  p-label="Produto"
                  [p-options]="produtos"
                  p-optional="false"
                  p-placeholder=""
                  p-required="false"
                  p-readonly="false"
                  p-auto-focus="false">
                </po-select>
                <po-tree-view
                  [p-selectable]="true"
                  [p-items]="produtosTree[i]"
                  (p-selected)="addItem($event)"
                  (p-unselected)="removeItem($event)"
                  [p-max-level]="5">
                </po-tree-view>
                <po-divider></po-divider>
                <po-multiselect
                  name="servicos"
                  p-label="Serviços"
                  [p-options]="opcoesServicos"
                  (p-change)="changeservico($event)">
                </po-multiselect>
                <po-widget
                  p-title="Serviços do produto"
                  (p-primary-action)="checkOut()"
                  *ngIf="itemsListSelected.length > 0">
                  <po-table
                    p-striped
                    [p-columns]="columnsItemsSelected"
                    [p-items]="itemsListSelected"
                    [p-hide-table-search]="true"
                    [p-hide-columns-manager]="true">
                  </po-table>
                </po-widget>
                <po-button 
                  *ngIf="estruturas.length > 1"
                  class="po-table-actions"
                  p-icon="ph ph-trash"
                  p-label=" "
                  p-danger="true"
                  (p-click)="removerEstrutura(i)">
                </po-button>
              </po-accordion-item>
            </po-accordion> 
          </div>
          <div *ngIf="produtosEstrutura.length > 0">
            <po-table
              class="po-lg-8"
              p-container="true"
              [p-height]="700"
              [p-hide-columns-manager]="true"
              [p-hide-batch-actions]="false"
              [p-hide-table-search]="false"
              [p-selectable]="true"
              [p-sort]="true"
              [p-actions]="actions"
              [p-columns]="columns"
              [p-items]="produtosEstrutura"
              [p-max-columns]="7"
              (p-collapsed)="onCollapseDetail()"
              (p-expanded)="onExpandDetail()"
              (p-selected)="sumTotal($event)"
              (p-unselected)="decreaseTotal($event)"
              (p-change-visible-columns)="changeColumnVisible($event)"
              (p-delete-items)="deleteItems($event)"
              (click)="onRowClick($event)">
            </po-table>
          </div>
        </po-step>
        <po-step p-label="Produtividade" class="tsc-center" [p-can-active-next-step]="isConfirmed.bind(this)">
          <p class="po-font-subtitle">Revise os totais da estrutura</p>
          <po-widget
            p-primary-label="Gravar estrutura"
            p-title="Revisão dos valores"
            *ngIf="itemsListSelected.length > 0"
            (p-primary-action)="checkOut()">
            <po-table
              p-striped
              [p-columns]="columnsItemsSelected"
              [p-items]="itemsListSelected"
              [p-hide-table-search]="true"
              [p-hide-columns-manager]="true">
            </po-table>
          </po-widget>
        </po-step>
        <po-step p-label="Confirmação">
          <po-widget>
            <div class="po-row po-font-display">
              <p>Estrutura finalizada</p>
              <po-icon p-icon="po-icon ph ph-check"></po-icon>
            </div>
          </po-widget>
        </po-step>
      </po-stepper>
    </div>
    <po-loading-overlay *ngIf="isLoadingPayment" p-text="Loading"> </po-loading-overlay>
  </po-page-default>